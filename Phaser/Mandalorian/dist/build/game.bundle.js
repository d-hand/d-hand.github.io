!function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PistolFactory=e.Pistol=void 0;var o=function(){function t(t){var e=t.pistol,n=t.objectFactory;this.lastFired=0,this.pistol=e,this.objectFactory=n}return t.prototype.setActivate=function(t){this.pistol.setVisible(t)},t.prototype.fire=function(t,e,n,o){if(t>this.lastFired){var r=i.shotSprites[Math.floor(5*Math.random())],a=this.objectFactory.sprite(n,o,r);a.play(r),a.once(Phaser.Animations.Events.SPRITE_ANIMATION_COMPLETE,(function(){return a.destroy()})),this.lastFired=t+800}},t}();e.Pistol=o;var i=function(){function t(){}return t.load=function(e){e.load.image(t.pistol,t.pistol);for(var n=0,o=t.shotSprites;n<o.length;n++){var i=o[n];e.load.spritesheet(i,i,{frameWidth:32,frameHeight:32,endFrame:3})}},t.create=function(e,n){t.shotSprites.map((function(t){return e.createAnimation({key:t,frames:e.anims.generateFrameNames(t),hideOnComplete:!0})}));var i=e.add.sprite(12,-10,t.pistol).setVisible(!1);return n.add(i),new o({objectFactory:e.add,pistol:i})},t.pistol="assets/pistol.png",t.shotSprites=["assets/pistol-shot.png","assets/pistol-shot-up.png","assets/pistol-shot-right.png","assets/pistol-shot-bottom.png","assets/pistol-shot-left.png"],t}();e.PistolFactory=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RocketGunFactory=e.RocketGun=void 0;var o=n(2),i=function(){function t(t){var e=t.rocketGun,n=t.rocketGroup;this.lastFired=0,this.rocketGun=e,this.rocketGroup=n}return t.prototype.setActivate=function(t){this.rocketGun.setVisible(t)},t.prototype.fire=function(t,e,n,o){if(t>this.lastFired){var i=this.rocketGroup.get();i&&(i.activate(this.rocketGun.parentContainer.x,this.rocketGun.parentContainer.y,n,o),this.lastFired=t+600)}},t}();e.RocketGun=i;var r=function(){function t(){}return t.load=function(e){e.load.image({key:t.image,url:t.image})},t.create=function(e,n){var r=e.add.group({classType:o.Rocket,maxSize:20,runChildUpdate:!0}),a=e.add.sprite(12,-7,t.image).setVisible(!1);return n.add(a),new i({rocketGun:a,rocketGroup:r})},t.image="assets/rocket-gun.png",t}();e.RocketGunFactory=r},function(t,e,n){"use strict";var o,i=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.RocketFactory=e.Rocket=void 0;var r=function(t){function e(e){var n=t.call(this,e,0,0,a.rocketImage)||this;return n.displayHeight=7,n.displayWidth=15,n.incX=0,n.incY=0,n.speed=Phaser.Math.GetSpeed(400,1),n}return i(e,t),e.prototype.activate=function(t,e,n,o){this.x1=t,this.y1=e,this.x2=n,this.y2=o,this.setActive(!0),this.setVisible(!0),this.setPosition(t,e);var i=Phaser.Math.Angle.Between(n,o,t,e);this.setRotation(i),this.incX=Math.cos(i),this.incY=Math.sin(i)},e.prototype.update=function(t,e){if(this.x-=this.incX*(this.speed*e),this.y-=this.incY*(this.speed*e),Math.abs(this.x2-this.x1)-Math.abs(this.x-this.x1)<0||Math.abs(this.y2-this.y1)-Math.abs(this.y-this.y1)<0){this.setActive(!1),this.setVisible(!1);var n=this.scene.add.sprite(this.x,this.y,a.explosionSprite);n.setScale(10),n.play(a.explosionSprite),n.once(Phaser.Animations.Events.SPRITE_ANIMATION_COMPLETE,(function(){return n.destroy()})),this.destroy(),console.log("destroy")}},e}(Phaser.GameObjects.Image);e.Rocket=r;var a=function(){function t(){}return t.load=function(e){e.load.image({key:t.rocketImage,url:t.rocketImage}),e.load.spritesheet(t.explosionSprite,t.explosionSprite,{frameWidth:64,frameHeight:64,endFrame:23})},t.addAnimationToScene=function(e){return e.anims.create({key:t.explosionSprite,frames:e.anims.generateFrameNames(t.explosionSprite),hideOnComplete:!0})},t.rocketImage="assets/rocket.png",t.explosionSprite="assets/rocket-explosion.png",t}();e.RocketFactory=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(4);var o=n(6),i={type:Phaser.WEBGL,width:800,height:600,backgroundColor:"#2d2d2d",scene:o.Scene};new Phaser.Game(i)},function(t,e,n){t.exports=n(5)(1)},function(t,e){t.exports=vendor},function(t,e,n){"use strict";var o,i=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.Scene=void 0;var r=n(7),a=n(2),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.preload=function(){a.RocketFactory.load(this),r.MandalorianFactory.load(this)},e.prototype.create=function(){a.RocketFactory.addAnimationToScene(this),this.mandalorian=r.MandalorianFactory.create(this)},e.prototype.update=function(t,e){this.mandalorian.update(t,e)},e.prototype.createAnimation=function(t){var e=this.anims.create(t);if(!1===e)throw new Error("Не удалось созать анимацию "+t.key);return e},e}(Phaser.Scene);e.Scene=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MandalorianFactory=e.Mandalorian=void 0;var o=n(8),i=n(0),r=n(1),a=function(){function t(t){var e=t.mandalorian,n=t.weapons,o=t.keyboard,i=t.mouse;this.speed=Phaser.Math.GetSpeed(100,1),this.mandalorian=e,this.weapons=n,this.mouse=i,this.up=[o.addKey("up"),o.addKey("E")],this.left=[o.addKey("left"),o.addKey("S")],this.bottom=[o.addKey("down"),o.addKey("D")],this.right=[o.addKey("right"),o.addKey("F")]}return t.prototype.update=function(t,e){this.weapons.update(t,e),this.mandalorian.x+=e*this.speed*(Number(this.right.some((function(t){return t.isDown})))-Number(this.left.some((function(t){return t.isDown})))),this.mandalorian.y+=e*this.speed*(Number(this.bottom.some((function(t){return t.isDown})))-Number(this.up.some((function(t){return t.isDown})))),null==this.mouse.x&&null==this.mouse.x||this.mandalorian.setRotation(Phaser.Math.Angle.Between(this.mouse.x,this.mouse.y,this.mandalorian.x,this.mandalorian.y)-Math.PI/2)},t}();e.Mandalorian=a;var s=function(){function t(){}return t.load=function(e){i.PistolFactory.load(e),r.RocketGunFactory.load(e),e.load.image(t.mandalorianSprite,"assets/mandalorian.png")},t.create=function(e){var n=e.input.keyboard,i=e.input.mousePointer,r=e.add.sprite(0,0,t.mandalorianSprite),s=e.add.container(400,400,[r]).setDepth(1),c=o.MandalorianWeaponFactory.create(e,s);return new a({mandalorian:s,weapons:c,keyboard:n,mouse:i})},t.mandalorianSprite="mandalorianSprite",t}();e.MandalorianFactory=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MandalorianWeaponFactory=e.MandalorianWeapons=void 0;var o=n(0),i=n(1),r=function(){function t(t){var e=this,n=t.pistol,o=t.rocketGun,i=t.input,r=t.mouse;this.activated=0,this.getWeapon=function(){return e.weapons[e.activated]},this.weapons=[n,o],this.mouse=r,this.getWeapon().setActivate(!0),i.on(Phaser.Input.Events.POINTER_DOWN,(function(){e.isAttack=!0})),i.on(Phaser.Input.Events.POINTER_UP,(function(){e.isAttack=!1})),i.keyboard.addKey("W").on(Phaser.Input.Keyboard.Events.DOWN,(function(){e.getWeapon().setActivate(!1),++e.activated>=e.weapons.length&&(e.activated=0),e.getWeapon().setActivate(!0)}))}return t.prototype.update=function(t,e){this.isAttack&&this.getWeapon().fire(t,e,this.mouse.x,this.mouse.y)},t}();e.MandalorianWeapons=r;var a=function(){function t(){}return t.create=function(t,e){var n=t.input,a=t.input.mousePointer,s=o.PistolFactory.create(t,e),c=i.RocketGunFactory.create(t,e);return new r({pistol:s,rocketGun:c,input:n,mouse:a})},t}();e.MandalorianWeaponFactory=a}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL1Bpc3RvbC50cyIsIndlYnBhY2s6Ly8vLi9zcmMvUm9ja2V0R3VuLnRzIiwid2VicGFjazovLy8uL3NyYy9Sb2NrZXQudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL0dhbWUudHMiLCJ3ZWJwYWNrOi8vL2RlbGVnYXRlZCAuL25vZGVfbW9kdWxlcy9waGFzZXIvZGlzdC9waGFzZXIuanMgZnJvbSBkbGwtcmVmZXJlbmNlIHZlbmRvciIsIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCJ2ZW5kb3JcIiIsIndlYnBhY2s6Ly8vLi9zcmMvU2NlbmUudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL01hbmRhbG9yaWFuLnRzIiwid2VicGFjazovLy8uL3NyYy9NYW5kYWxvcmlhbldlYXBvbnMudHMiXSwibmFtZXMiOlsiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJwaXN0b2wiLCJvYmplY3RGYWN0b3J5IiwibGFzdEZpcmVkIiwidGhpcyIsInNldEFjdGl2YXRlIiwiYWN0aXZhdGVkIiwic2V0VmlzaWJsZSIsImZpcmUiLCJ0aW1lIiwiZGVsdGEiLCJ4IiwieSIsInNwcml0ZU5hbWUiLCJQaXN0b2xGYWN0b3J5Iiwic2hvdFNwcml0ZXMiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJzcHJpdGUiLCJwbGF5Iiwib25jZSIsIlBoYXNlciIsIkFuaW1hdGlvbnMiLCJFdmVudHMiLCJTUFJJVEVfQU5JTUFUSU9OX0NPTVBMRVRFIiwiZGVzdHJveSIsIlBpc3RvbCIsImxvYWQiLCJzY2VuZSIsImltYWdlIiwic3ByaXRlc2hlZXQiLCJmcmFtZVdpZHRoIiwiZnJhbWVIZWlnaHQiLCJlbmRGcmFtZSIsImNvbnRhaW5lciIsIm1hcCIsImNyZWF0ZUFuaW1hdGlvbiIsImZyYW1lcyIsImFuaW1zIiwiZ2VuZXJhdGVGcmFtZU5hbWVzIiwiaGlkZU9uQ29tcGxldGUiLCJhZGQiLCJyb2NrZXRHdW4iLCJyb2NrZXRHcm91cCIsInJvY2tldCIsImFjdGl2YXRlIiwicGFyZW50Q29udGFpbmVyIiwiUm9ja2V0R3VuIiwiUm9ja2V0R3VuRmFjdG9yeSIsInVybCIsImdyb3VwIiwiY2xhc3NUeXBlIiwiUm9ja2V0IiwibWF4U2l6ZSIsInJ1bkNoaWxkVXBkYXRlIiwiUm9ja2V0RmFjdG9yeSIsInJvY2tldEltYWdlIiwiZGlzcGxheUhlaWdodCIsImRpc3BsYXlXaWR0aCIsImluY1giLCJpbmNZIiwic3BlZWQiLCJHZXRTcGVlZCIsIngxIiwieTEiLCJ4MiIsInkyIiwic2V0QWN0aXZlIiwic2V0UG9zaXRpb24iLCJhbmdsZSIsIkFuZ2xlIiwiQmV0d2VlbiIsInNldFJvdGF0aW9uIiwiY29zIiwic2luIiwidXBkYXRlIiwiYWJzIiwiZXhwbG9zaW9uU3ByaXRlIiwic2V0U2NhbGUiLCJjb25zb2xlIiwibG9nIiwiR2FtZU9iamVjdHMiLCJJbWFnZSIsImFkZEFuaW1hdGlvblRvU2NlbmUiLCJjb25maWciLCJ0eXBlIiwiV0VCR0wiLCJ3aWR0aCIsImhlaWdodCIsImJhY2tncm91bmRDb2xvciIsIlNjZW5lIiwiR2FtZSIsInZlbmRvciIsInByZWxvYWQiLCJNYW5kYWxvcmlhbkZhY3RvcnkiLCJtYW5kYWxvcmlhbiIsInJlc3VsdCIsIkVycm9yIiwid2VhcG9ucyIsImtleWJvYXJkIiwibW91c2UiLCJ1cCIsImFkZEtleSIsImxlZnQiLCJib3R0b20iLCJyaWdodCIsIk51bWJlciIsInNvbWUiLCJpc0Rvd24iLCJ1bmRlZmluZWQiLCJQSSIsIk1hbmRhbG9yaWFuIiwibWFuZGFsb3JpYW5TcHJpdGUiLCJpbnB1dCIsIm1vdXNlUG9pbnRlciIsInNldERlcHRoIiwiTWFuZGFsb3JpYW5XZWFwb25GYWN0b3J5IiwiZ2V0V2VhcG9uIiwib24iLCJJbnB1dCIsIlBPSU5URVJfRE9XTiIsImlzQXR0YWNrIiwiUE9JTlRFUl9VUCIsIktleWJvYXJkIiwiRE9XTiIsImxlbmd0aCIsIk1hbmRhbG9yaWFuV2VhcG9ucyJdLCJtYXBwaW5ncyI6ImFBQ0UsSUFBSUEsRUFBbUIsR0FHdkIsU0FBU0MsRUFBb0JDLEdBRzVCLEdBQUdGLEVBQWlCRSxHQUNuQixPQUFPRixFQUFpQkUsR0FBVUMsUUFHbkMsSUFBSUMsRUFBU0osRUFBaUJFLEdBQVksQ0FDekNHLEVBQUdILEVBQ0hJLEdBQUcsRUFDSEgsUUFBUyxJQVVWLE9BTkFJLEVBQVFMLEdBQVVNLEtBQUtKLEVBQU9ELFFBQVNDLEVBQVFBLEVBQU9ELFFBQVNGLEdBRy9ERyxFQUFPRSxHQUFJLEVBR0pGLEVBQU9ELFFBS2ZGLEVBQW9CUSxFQUFJRixFQUd4Qk4sRUFBb0JTLEVBQUlWLEVBR3hCQyxFQUFvQlUsRUFBSSxTQUFTUixFQUFTUyxFQUFNQyxHQUMzQ1osRUFBb0JhLEVBQUVYLEVBQVNTLElBQ2xDRyxPQUFPQyxlQUFlYixFQUFTUyxFQUFNLENBQUVLLFlBQVksRUFBTUMsSUFBS0wsS0FLaEVaLEVBQW9Ca0IsRUFBSSxTQUFTaEIsR0FDWCxvQkFBWGlCLFFBQTBCQSxPQUFPQyxhQUMxQ04sT0FBT0MsZUFBZWIsRUFBU2lCLE9BQU9DLFlBQWEsQ0FBRUMsTUFBTyxXQUU3RFAsT0FBT0MsZUFBZWIsRUFBUyxhQUFjLENBQUVtQixPQUFPLEtBUXZEckIsRUFBb0JzQixFQUFJLFNBQVNELEVBQU9FLEdBRXZDLEdBRFUsRUFBUEEsSUFBVUYsRUFBUXJCLEVB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TWhHLE9BQU9pRyxjQUFjLFdBQ3ZDLEVBQUtDLFVBQVcsS0FHcEJSLEVBQU1LLEdBQUdqRyxPQUFPa0csTUFBTWhHLE9BQU9tRyxZQUFZLFdBQ3JDLEVBQUtELFVBQVcsS0FHcEJSLEVBQU1kLFNBQVNHLE9BQU8sS0FBS2dCLEdBQUdqRyxPQUFPa0csTUFBTUksU0FBU3BHLE9BQU9xRyxNQUFNLFdBQzdELEVBQUtQLFlBQVlqSCxhQUFZLEtBRXZCLEVBQUtDLFdBQWEsRUFBSzZGLFFBQVEyQixTQUNqQyxFQUFLeEgsVUFBWSxHQUVyQixFQUFLZ0gsWUFBWWpILGFBQVksTUFZekMsT0FQSSxZQUFBdUUsT0FBQSxTQUFPbkUsRUFBY0MsR0FDYk4sS0FBS3NILFVBQ0x0SCxLQUFLa0gsWUFBWTlHLEtBQUtDLEVBQU1DLEVBQU9OLEtBQUtpRyxNQUFNMUYsRUFBR1AsS0FBS2lHLE1BQU16RixJQUt4RSxFQXRDQSxHQUFhLEVBQUFtSCxxQkF3Q2IsK0JBUUEsT0FQVyxFQUFBeEksT0FBUCxTQUFjc0MsRUFBY00sR0FDeEIsSUFBTStFLEVBQVFyRixFQUFNcUYsTUFDZGIsRUFBUXhFLEVBQU1xRixNQUFNQyxhQUNwQmxILEVBQVMsRUFBQWEsY0FBY3ZCLE9BQU9zQyxFQUFPTSxHQUNyQ1EsRUFBWSxFQUFBTSxpQkFBaUIxRCxPQUFPc0MsRUFBT00sR0FDakQsT0FBTyxJQUFJNEYsRUFBbUIsQ0FBQzlILE9BQU0sRUFBRTBDLFVBQVMsRUFBRXVFLE1BQUssRUFBRWIsTUFBSyxLQUV0RSxFQVJBLEdBQWEsRUFBQWdCIiwiZmlsZSI6ImdhbWUuYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDMpO1xuIiwiaW1wb3J0IHsgUGFpckZhY3RvcnkgfSBmcm9tIFwibWF0dGVyXCI7XHJcbmltcG9ydCB7IElNYW5kYWxvcmlhbldlYXBvbiB9IGZyb20gXCIuL01hbmRhbG9yaWFuV2VhcG9uc1wiO1xyXG5pbXBvcnQgeyBTY2VuZSB9IGZyb20gXCIuL1NjZW5lXCI7XHJcblxyXG5pbnRlcmZhY2UgSVBhcmFtcyB7XHJcbiAgICBwaXN0b2w6IFBoYXNlci5HYW1lT2JqZWN0cy5TcHJpdGU7XHJcbiAgICBvYmplY3RGYWN0b3J5OiBQaGFzZXIuR2FtZU9iamVjdHMuR2FtZU9iamVjdEZhY3Rvcnk7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBQaXN0b2wgaW1wbGVtZW50cyBJTWFuZGFsb3JpYW5XZWFwb24ge1xyXG4gICAgcGlzdG9sOiBQaGFzZXIuR2FtZU9iamVjdHMuU3ByaXRlO1xyXG4gICAgb2JqZWN0RmFjdG9yeTogUGhhc2VyLkdhbWVPYmplY3RzLkdhbWVPYmplY3RGYWN0b3J5O1xyXG4gICAgbGFzdEZpcmVkID0gMDtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcih7cGlzdG9sLCBvYmplY3RGYWN0b3J5fSA6IElQYXJhbXMpIHtcclxuICAgICAgICB0aGlzLnBpc3RvbCA9IHBpc3RvbDtcclxuICAgICAgICB0aGlzLm9iamVjdEZhY3RvcnkgPSBvYmplY3RGYWN0b3J5O1xyXG4gICAgfVxyXG5cclxuICAgIHNldEFjdGl2YXRlKGFjdGl2YXRlZDogYm9vbGVhbikge1xyXG4gICAgICAgIHRoaXMucGlzdG9sLnNldFZpc2libGUoYWN0aXZhdGVkKTtcclxuICAgIH1cclxuXHJcbiAgICBmaXJlKHRpbWU6IG51bWJlciwgZGVsdGE6IG51bWJlciwgeDogbnVtYmVyLCB5OiBudW1iZXIpIHtcclxuICAgICAgICBpZiAodGltZSA+IHRoaXMubGFzdEZpcmVkKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNwcml0ZU5hbWUgPSBQaXN0b2xGYWN0b3J5LnNob3RTcHJpdGVzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDUpXTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHNob3RTcHJpdGUgPSB0aGlzLm9iamVjdEZhY3Rvcnkuc3ByaXRlKHgsIHksIHNwcml0ZU5hbWUpO1xyXG4gICAgICAgICAgICBzaG90U3ByaXRlLnBsYXkoc3ByaXRlTmFtZSk7XHJcbiAgICAgICAgICAgIHNob3RTcHJpdGUub25jZShQaGFzZXIuQW5pbWF0aW9ucy5FdmVudHMuU1BSSVRFX0FOSU1BVElPTl9DT01QTEVURSwgKCkgPT4gc2hvdFNwcml0ZS5kZXN0cm95KCkpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5sYXN0RmlyZWQgPSB0aW1lICsgODAwO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFBpc3RvbEZhY3Rvcnkge1xyXG4gICAgc3RhdGljIHJlYWRvbmx5IHBpc3RvbCA9ICdhc3NldHMvcGlzdG9sLnBuZyc7XHJcblxyXG4gICAgc3RhdGljIHJlYWRvbmx5IHNob3RTcHJpdGVzID0gW1xyXG4gICAgICAgICdhc3NldHMvcGlzdG9sLXNob3QucG5nJyxcclxuICAgICAgICAnYXNzZXRzL3Bpc3RvbC1zaG90LXVwLnBuZycsXHJcbiAgICAgICAgJ2Fzc2V0cy9waXN0b2wtc2hvdC1yaWdodC5wbmcnLFxyXG4gICAgICAgICdhc3NldHMvcGlzdG9sLXNob3QtYm90dG9tLnBuZycsXHJcbiAgICAgICAgJ2Fzc2V0cy9waXN0b2wtc2hvdC1sZWZ0LnBuZydcclxuICAgIF07XHJcblxyXG4gICAgc3RhdGljIGxvYWQoc2NlbmU6IFNjZW5lKSB7XHJcbiAgICAgICAgc2NlbmUubG9hZC5pbWFnZShQaXN0b2xGYWN0b3J5LnBpc3RvbCwgUGlzdG9sRmFjdG9yeS5waXN0b2wpO1xyXG5cclxuICAgICAgICBmb3IgKHZhciBzcHJpdGUgb2YgUGlzdG9sRmFjdG9yeS5zaG90U3ByaXRlcylcclxuICAgICAgICAgICAgc2NlbmUubG9hZC5zcHJpdGVzaGVldChzcHJpdGUsIHNwcml0ZSwgeyBmcmFtZVdpZHRoOiAzMiwgZnJhbWVIZWlnaHQ6IDMyLCBlbmRGcmFtZTogMyB9KTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgY3JlYXRlKHNjZW5lOiBTY2VuZSwgY29udGFpbmVyOiBQaGFzZXIuR2FtZU9iamVjdHMuQ29udGFpbmVyKSB7XHJcbiAgICAgICAgUGlzdG9sRmFjdG9yeS5zaG90U3ByaXRlcy5tYXAoc3ByaXRlID0+IHNjZW5lLmNyZWF0ZUFuaW1hdGlvbih7XHJcbiAgICAgICAgICAgIGtleTogc3ByaXRlLFxyXG4gICAgICAgICAgICBmcmFtZXM6IHNjZW5lLmFuaW1zLmdlbmVyYXRlRnJhbWVOYW1lcyhzcHJpdGUpLFxyXG4gICAgICAgICAgICBoaWRlT25Db21wbGV0ZTogdHJ1ZSxcclxuICAgICAgICB9KSk7XHJcblxyXG4gICAgICAgIGNvbnN0IHBpc3RvbCA9IHNjZW5lLmFkZC5zcHJpdGUoMTIsIC0xMCwgUGlzdG9sRmFjdG9yeS5waXN0b2wpLnNldFZpc2libGUoZmFsc2UpO1xyXG4gICAgICAgIGNvbnRhaW5lci5hZGQocGlzdG9sKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG5ldyBQaXN0b2woe29iamVjdEZhY3Rvcnk6IHNjZW5lLmFkZCwgcGlzdG9sfSk7XHJcbiAgICB9XHJcbn1cclxuIiwiaW1wb3J0IHsgSU1hbmRhbG9yaWFuV2VhcG9uIH0gZnJvbSBcIi4vTWFuZGFsb3JpYW5XZWFwb25zXCI7XHJcbmltcG9ydCB7IFJvY2tldCB9IGZyb20gXCIuL1JvY2tldFwiO1xyXG5pbXBvcnQgeyBTY2VuZSB9IGZyb20gXCIuL1NjZW5lXCI7XHJcblxyXG5pbnRlcmZhY2UgSVBhcmFtcyB7XHJcbiAgICByb2NrZXRHdW46IFBoYXNlci5HYW1lT2JqZWN0cy5TcHJpdGU7XHJcbiAgICByb2NrZXRHcm91cDogUGhhc2VyLkdhbWVPYmplY3RzLkdyb3VwO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgUm9ja2V0R3VuIGltcGxlbWVudHMgSU1hbmRhbG9yaWFuV2VhcG9uIHtcclxuICAgIHJvY2tldEd1bjogUGhhc2VyLkdhbWVPYmplY3RzLlNwcml0ZTtcclxuICAgIHJvY2tldEdyb3VwOiBQaGFzZXIuR2FtZU9iamVjdHMuR3JvdXA7XHJcbiAgICBsYXN0RmlyZWQgPSAwOyAgICBcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcih7cm9ja2V0R3VuLCByb2NrZXRHcm91cH0gOiBJUGFyYW1zKSB7XHJcbiAgICAgICAgdGhpcy5yb2NrZXRHdW4gPSByb2NrZXRHdW47XHJcbiAgICAgICAgdGhpcy5yb2NrZXRHcm91cCA9IHJvY2tldEdyb3VwO1xyXG4gICAgfVxyXG5cclxuICAgIHNldEFjdGl2YXRlKGFjdGl2YXRlZDogYm9vbGVhbikge1xyXG4gICAgICAgIHRoaXMucm9ja2V0R3VuLnNldFZpc2libGUoYWN0aXZhdGVkKTtcclxuICAgIH1cclxuXHJcbiAgICBmaXJlKHRpbWU6IG51bWJlciwgZGVsdGE6IG51bWJlciwgeDogbnVtYmVyLCB5OiBudW1iZXIpIHtcclxuICAgICAgICBpZiAodGltZSA+IHRoaXMubGFzdEZpcmVkKSB7XHJcbiAgICAgICAgICAgIHZhciByb2NrZXQgPSB0aGlzLnJvY2tldEdyb3VwLmdldCgpIGFzIFJvY2tldDtcclxuXHJcbiAgICAgICAgICAgIGlmIChyb2NrZXQpIHtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgcm9ja2V0LmFjdGl2YXRlKHRoaXMucm9ja2V0R3VuLnBhcmVudENvbnRhaW5lci54LCB0aGlzLnJvY2tldEd1bi5wYXJlbnRDb250YWluZXIueSwgeCwgeSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5sYXN0RmlyZWQgPSB0aW1lICsgNjAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgUm9ja2V0R3VuRmFjdG9yeSB7XHJcblxyXG4gICAgc3RhdGljIHJlYWRvbmx5IGltYWdlID0gJ2Fzc2V0cy9yb2NrZXQtZ3VuLnBuZyc7XHJcblxyXG4gICAgc3RhdGljIGxvYWQoc2NlbmU6IFNjZW5lKSB7XHJcbiAgICAgICAgc2NlbmUubG9hZC5pbWFnZSh7XHJcbiAgICAgICAgICAgIGtleTogUm9ja2V0R3VuRmFjdG9yeS5pbWFnZSxcclxuICAgICAgICAgICAgdXJsOiBSb2NrZXRHdW5GYWN0b3J5LmltYWdlLFxyXG4gICAgICAgIH0pOyAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGNyZWF0ZShzY2VuZTogU2NlbmUsIGNvbnRhaW5lcjogUGhhc2VyLkdhbWVPYmplY3RzLkNvbnRhaW5lcikge1xyXG4gICAgICAgIGNvbnN0IHJvY2tldEdyb3VwID0gc2NlbmUuYWRkLmdyb3VwKHtcclxuICAgICAgICAgICAgY2xhc3NUeXBlOiBSb2NrZXQsXHJcbiAgICAgICAgICAgIG1heFNpemU6IDIwLFxyXG4gICAgICAgICAgICBydW5DaGlsZFVwZGF0ZTogdHJ1ZVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCByb2NrZXRHdW4gPSBzY2VuZS5hZGQuc3ByaXRlKDEyLCAtNywgUm9ja2V0R3VuRmFjdG9yeS5pbWFnZSkuc2V0VmlzaWJsZShmYWxzZSk7XHJcbiAgICAgICAgY29udGFpbmVyLmFkZChyb2NrZXRHdW4pO1xyXG5cclxuXHJcbiAgICAgICAgcmV0dXJuIG5ldyBSb2NrZXRHdW4oe3JvY2tldEd1biwgcm9ja2V0R3JvdXB9KTtcclxuICAgIH1cclxufVxyXG4iLCJpbXBvcnQgeyBTY2VuZSB9IGZyb20gXCIuL1NjZW5lXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgUm9ja2V0IGV4dGVuZHMgUGhhc2VyLkdhbWVPYmplY3RzLkltYWdlIHtcclxuICAgIGluY1g6IG51bWJlcjtcclxuICAgIGluY1k6IG51bWJlcjtcclxuICAgIHgxOiBudW1iZXI7XHJcbiAgICB5MTogbnVtYmVyO1xyXG4gICAgeDI6IG51bWJlcjtcclxuICAgIHkyOiBudW1iZXI7XHJcbiAgICBzcGVlZDogbnVtYmVyO1xyXG4gICAgYm9vbVNwcml0ZTogUGhhc2VyLkdhbWVPYmplY3RzLlNwcml0ZTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihzY2VuZTogU2NlbmUpIHtcclxuICAgICAgICBzdXBlcihzY2VuZSwgMCwgMCwgUm9ja2V0RmFjdG9yeS5yb2NrZXRJbWFnZSk7XHJcblxyXG4gICAgICAgIHRoaXMuZGlzcGxheUhlaWdodCA9IDc7XHJcbiAgICAgICAgdGhpcy5kaXNwbGF5V2lkdGggPSAxNTtcclxuICAgICAgICB0aGlzLmluY1ggPSAwO1xyXG4gICAgICAgIHRoaXMuaW5jWSA9IDA7XHJcbiAgICAgICAgdGhpcy5zcGVlZCA9IFBoYXNlci5NYXRoLkdldFNwZWVkKDQwMCwgMSk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGFjdGl2YXRlKHgxOiBudW1iZXIsIHkxOiBudW1iZXIsIHgyOiBudW1iZXIsIHkyOiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLngxID0geDE7XHJcbiAgICAgICAgdGhpcy55MSA9IHkxO1xyXG4gICAgICAgIHRoaXMueDIgPSB4MjtcclxuICAgICAgICB0aGlzLnkyID0geTI7XHJcblxyXG4gICAgICAgIHRoaXMuc2V0QWN0aXZlKHRydWUpO1xyXG4gICAgICAgIHRoaXMuc2V0VmlzaWJsZSh0cnVlKTtcclxuXHJcbiAgICAgICAgdGhpcy5zZXRQb3NpdGlvbih4MSwgeTEpO1xyXG5cclxuICAgICAgICB2YXIgYW5nbGUgPSBQaGFzZXIuTWF0aC5BbmdsZS5CZXR3ZWVuKHgyLCB5MiwgeDEsIHkxKTtcclxuXHJcbiAgICAgICAgdGhpcy5zZXRSb3RhdGlvbihhbmdsZSk7XHJcblxyXG4gICAgICAgIHRoaXMuaW5jWCA9IE1hdGguY29zKGFuZ2xlKTtcclxuICAgICAgICB0aGlzLmluY1kgPSBNYXRoLnNpbihhbmdsZSk7XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlKHRpbWU6IG51bWJlciwgZGVsdGE6IG51bWJlcikge1xyXG5cclxuICAgICAgICB0aGlzLnggLT0gdGhpcy5pbmNYICogKHRoaXMuc3BlZWQgKiBkZWx0YSk7XHJcbiAgICAgICAgdGhpcy55IC09IHRoaXMuaW5jWSAqICh0aGlzLnNwZWVkICogZGVsdGEpO1xyXG5cclxuICAgICAgICBpZiAoTWF0aC5hYnModGhpcy54MiAtIHRoaXMueDEpIC0gTWF0aC5hYnModGhpcy54IC0gdGhpcy54MSkgPCAwIHx8XHJcbiAgICAgICAgICAgIE1hdGguYWJzKHRoaXMueTIgLSB0aGlzLnkxKSAtIE1hdGguYWJzKHRoaXMueSAtIHRoaXMueTEpIDwgMCkge1xyXG4gICAgICAgICAgICB0aGlzLnNldEFjdGl2ZShmYWxzZSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0VmlzaWJsZShmYWxzZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCBleHBsb3Npb25TcHJpdGUgPSB0aGlzLnNjZW5lLmFkZC5zcHJpdGUodGhpcy54LCB0aGlzLnksIFJvY2tldEZhY3RvcnkuZXhwbG9zaW9uU3ByaXRlKTsgICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwbG9zaW9uU3ByaXRlLnNldFNjYWxlKDEwKVxyXG4gICAgICAgICAgICBleHBsb3Npb25TcHJpdGUucGxheShSb2NrZXRGYWN0b3J5LmV4cGxvc2lvblNwcml0ZSk7XHJcbiAgICAgICAgICAgIGV4cGxvc2lvblNwcml0ZS5vbmNlKFBoYXNlci5BbmltYXRpb25zLkV2ZW50cy5TUFJJVEVfQU5JTUFUSU9OX0NPTVBMRVRFLCAoKSA9PiBleHBsb3Npb25TcHJpdGUuZGVzdHJveSgpKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHRoaXMuZGVzdHJveSgpO1xyXG5cclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2Rlc3Ryb3knKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBSb2NrZXRGYWN0b3J5IHtcclxuICAgIHN0YXRpYyByZWFkb25seSByb2NrZXRJbWFnZSA9ICdhc3NldHMvcm9ja2V0LnBuZyc7XHJcbiAgICBzdGF0aWMgcmVhZG9ubHkgZXhwbG9zaW9uU3ByaXRlID0gJ2Fzc2V0cy9yb2NrZXQtZXhwbG9zaW9uLnBuZyc7XHJcblxyXG4gICAgc3RhdGljIGxvYWQoc2NlbmU6IFNjZW5lKSB7XHJcbiAgICAgICAgc2NlbmUubG9hZC5pbWFnZSh7XHJcbiAgICAgICAgICAgIGtleTogUm9ja2V0RmFjdG9yeS5yb2NrZXRJbWFnZSxcclxuICAgICAgICAgICAgdXJsOiBSb2NrZXRGYWN0b3J5LnJvY2tldEltYWdlLFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBzY2VuZS5sb2FkLnNwcml0ZXNoZWV0KFJvY2tldEZhY3RvcnkuZXhwbG9zaW9uU3ByaXRlLCBSb2NrZXRGYWN0b3J5LmV4cGxvc2lvblNwcml0ZSwgeyBmcmFtZVdpZHRoOiA2NCwgZnJhbWVIZWlnaHQ6IDY0LCBlbmRGcmFtZTogMjMgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGFkZEFuaW1hdGlvblRvU2NlbmUoc2NlbmU6IFNjZW5lKSB7XHJcbiAgICAgICAgcmV0dXJuIHNjZW5lLmFuaW1zLmNyZWF0ZSh7XHJcbiAgICAgICAgICAgIGtleTogUm9ja2V0RmFjdG9yeS5leHBsb3Npb25TcHJpdGUsXHJcbiAgICAgICAgICAgIGZyYW1lczogc2NlbmUuYW5pbXMuZ2VuZXJhdGVGcmFtZU5hbWVzKFJvY2tldEZhY3RvcnkuZXhwbG9zaW9uU3ByaXRlKSxcclxuICAgICAgICAgICAgaGlkZU9uQ29tcGxldGU6IHRydWUsXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbiIsImltcG9ydCAncGhhc2VyJztcclxuaW1wb3J0IHtTY2VuZX0gZnJvbSAnLi9TY2VuZSc7XHJcblxyXG5jb25zdCBjb25maWcgPSB7XHJcbiAgICB0eXBlOiBQaGFzZXIuV0VCR0wsXHJcbiAgICB3aWR0aDogODAwLFxyXG4gICAgaGVpZ2h0OiA2MDAsXHJcbiAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjMmQyZDJkJyxcclxuICAgIHNjZW5lOiBTY2VuZVxyXG59O1xyXG5cclxuY29uc3QgZ2FtZSA9IG5ldyBQaGFzZXIuR2FtZShjb25maWcpO1xyXG4iLCJtb2R1bGUuZXhwb3J0cyA9IChfX3dlYnBhY2tfcmVxdWlyZV9fKDUpKSgxKTsiLCJtb2R1bGUuZXhwb3J0cyA9IHZlbmRvcjsiLCJpbXBvcnQgeyBNYW5kYWxvcmlhbiwgTWFuZGFsb3JpYW5GYWN0b3J5IH0gZnJvbSAnLi9NYW5kYWxvcmlhbic7XHJcbmltcG9ydCB7IFJvY2tldEZhY3RvcnkgfSBmcm9tICcuL1JvY2tldCc7XHJcblxyXG5leHBvcnQgY2xhc3MgU2NlbmUgZXh0ZW5kcyBQaGFzZXIuU2NlbmUgeyAgICBcclxuICAgIG1hbmRhbG9yaWFuOiBNYW5kYWxvcmlhbjtcclxuXHJcbiAgICBwcmVsb2FkKCkgeyAgICAgICAgXHJcbiAgICAgICAgUm9ja2V0RmFjdG9yeS5sb2FkKHRoaXMpO1xyXG4gICAgICAgIE1hbmRhbG9yaWFuRmFjdG9yeS5sb2FkKHRoaXMpO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZSgpIHtcclxuICAgICAgICBSb2NrZXRGYWN0b3J5LmFkZEFuaW1hdGlvblRvU2NlbmUodGhpcyk7XHJcbiAgICAgICAgdGhpcy5tYW5kYWxvcmlhbiA9IE1hbmRhbG9yaWFuRmFjdG9yeS5jcmVhdGUodGhpcyk7XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlKHRpbWU6IG51bWJlciwgZGVsdGE6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMubWFuZGFsb3JpYW4udXBkYXRlKHRpbWUsIGRlbHRhKTtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVBbmltYXRpb24oY29uZmlnOiBQaGFzZXIuVHlwZXMuQW5pbWF0aW9ucy5BbmltYXRpb24pIHtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gdGhpcy5hbmltcy5jcmVhdGUoY29uZmlnKTtcclxuICAgICAgICBpZiAocmVzdWx0ID09PSBmYWxzZSlcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGDQndC1INGD0LTQsNC70L7RgdGMINGB0L7Qt9Cw0YLRjCDQsNC90LjQvNCw0YbQuNGOICR7Y29uZmlnLmtleX1gKVxyXG5cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IHsgTWFuZGFsb3JpYW5XZWFwb25GYWN0b3J5LCBNYW5kYWxvcmlhbldlYXBvbnMgfSBmcm9tIFwiLi9NYW5kYWxvcmlhbldlYXBvbnNcIjtcclxuaW1wb3J0IHsgUGlzdG9sRmFjdG9yeSB9IGZyb20gXCIuL1Bpc3RvbFwiO1xyXG5pbXBvcnQgeyBSb2NrZXRHdW5GYWN0b3J5IH0gZnJvbSBcIi4vUm9ja2V0R3VuXCI7XHJcbmltcG9ydCB7IFNjZW5lIH0gZnJvbSBcIi4vU2NlbmVcIjtcclxuXHJcbmludGVyZmFjZSBJUGFyYW1zIHtcclxuICAgIG1hbmRhbG9yaWFuOiBQaGFzZXIuR2FtZU9iamVjdHMuQ29udGFpbmVyOyBcclxuICAgIHdlYXBvbnM6IE1hbmRhbG9yaWFuV2VhcG9ucztcclxuICAgIGtleWJvYXJkOiBQaGFzZXIuSW5wdXQuS2V5Ym9hcmQuS2V5Ym9hcmRQbHVnaW47XHJcbiAgICBtb3VzZTogUGhhc2VyLklucHV0LlBvaW50ZXI7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBNYW5kYWxvcmlhbiB7XHJcbiAgICBtYW5kYWxvcmlhbjogUGhhc2VyLkdhbWVPYmplY3RzLkNvbnRhaW5lcjtcclxuICAgIHdlYXBvbnM6IE1hbmRhbG9yaWFuV2VhcG9ucztcclxuICAgIG1vdXNlOiBQaGFzZXIuSW5wdXQuUG9pbnRlcjtcclxuXHJcbiAgICB1cDogUGhhc2VyLklucHV0LktleWJvYXJkLktleVtdO1xyXG4gICAgbGVmdDogUGhhc2VyLklucHV0LktleWJvYXJkLktleVtdO1xyXG4gICAgYm90dG9tOiBQaGFzZXIuSW5wdXQuS2V5Ym9hcmQuS2V5W107XHJcbiAgICByaWdodDogUGhhc2VyLklucHV0LktleWJvYXJkLktleVtdO1xyXG5cclxuICAgIHNwZWVkID0gUGhhc2VyLk1hdGguR2V0U3BlZWQoMTAwLCAxKTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcih7bWFuZGFsb3JpYW4sIHdlYXBvbnMsIGtleWJvYXJkLCBtb3VzZX06IElQYXJhbXMpIHtcclxuICAgICAgICB0aGlzLm1hbmRhbG9yaWFuID0gbWFuZGFsb3JpYW47XHJcbiAgICAgICAgdGhpcy53ZWFwb25zID0gd2VhcG9ucztcclxuICAgICAgICB0aGlzLm1vdXNlID0gbW91c2U7XHJcblxyXG4gICAgICAgIHRoaXMudXAgPSBba2V5Ym9hcmQuYWRkS2V5KCd1cCcpLCBrZXlib2FyZC5hZGRLZXkoJ0UnKV07XHJcbiAgICAgICAgdGhpcy5sZWZ0ID0gW2tleWJvYXJkLmFkZEtleSgnbGVmdCcpLCBrZXlib2FyZC5hZGRLZXkoJ1MnKV07XHJcbiAgICAgICAgdGhpcy5ib3R0b20gPSBba2V5Ym9hcmQuYWRkS2V5KCdkb3duJyksIGtleWJvYXJkLmFkZEtleSgnRCcpXTtcclxuICAgICAgICB0aGlzLnJpZ2h0ID0gW2tleWJvYXJkLmFkZEtleSgncmlnaHQnKSwga2V5Ym9hcmQuYWRkS2V5KCdGJyldO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZSh0aW1lOiBudW1iZXIsIGRlbHRhOiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLndlYXBvbnMudXBkYXRlKHRpbWUsIGRlbHRhKTtcclxuXHJcbiAgICAgICAgdGhpcy5tYW5kYWxvcmlhbi54ICs9IGRlbHRhICogdGhpcy5zcGVlZCAqIChOdW1iZXIodGhpcy5yaWdodC5zb21lKHggPT4geC5pc0Rvd24pKSAtIE51bWJlcih0aGlzLmxlZnQuc29tZSh4ID0+IHguaXNEb3duKSkpO1xyXG4gICAgICAgIHRoaXMubWFuZGFsb3JpYW4ueSArPSBkZWx0YSAqIHRoaXMuc3BlZWQgKiAoTnVtYmVyKHRoaXMuYm90dG9tLnNvbWUoeCA9PiB4LmlzRG93bikpIC0gTnVtYmVyKHRoaXMudXAuc29tZSh4ID0+IHguaXNEb3duKSkpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5tb3VzZS54ICE9IHVuZGVmaW5lZCB8fCB0aGlzLm1vdXNlLnggIT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICB0aGlzLm1hbmRhbG9yaWFuLnNldFJvdGF0aW9uKFBoYXNlci5NYXRoLkFuZ2xlLkJldHdlZW4odGhpcy5tb3VzZS54LCB0aGlzLm1vdXNlLnksIHRoaXMubWFuZGFsb3JpYW4ueCwgdGhpcy5tYW5kYWxvcmlhbi55KSAtIE1hdGguUEkgLyAyKTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIE1hbmRhbG9yaWFuRmFjdG9yeSB7XHJcbiAgICBzdGF0aWMgcmVhZG9ubHkgbWFuZGFsb3JpYW5TcHJpdGUgPSAnbWFuZGFsb3JpYW5TcHJpdGUnXHJcblxyXG4gICAgc3RhdGljIGxvYWQoc2NlbmU6IFNjZW5lKSB7XHJcbiAgICAgICAgUGlzdG9sRmFjdG9yeS5sb2FkKHNjZW5lKTtcclxuICAgICAgICBSb2NrZXRHdW5GYWN0b3J5LmxvYWQoc2NlbmUpO1xyXG4gICAgICAgIHNjZW5lLmxvYWQuaW1hZ2UoTWFuZGFsb3JpYW5GYWN0b3J5Lm1hbmRhbG9yaWFuU3ByaXRlLCAnYXNzZXRzL21hbmRhbG9yaWFuLnBuZycpO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBjcmVhdGUoc2NlbmU6IFNjZW5lKSB7XHJcbiAgICAgICAgY29uc3Qga2V5Ym9hcmQgPSBzY2VuZS5pbnB1dC5rZXlib2FyZDtcclxuICAgICAgICBjb25zdCBtb3VzZSA9IHNjZW5lLmlucHV0Lm1vdXNlUG9pbnRlcjtcclxuICAgICAgICBjb25zdCBtYW5kYWxvcmlhblNwcml0ZSA9IHNjZW5lLmFkZC5zcHJpdGUoMCwgMCwgTWFuZGFsb3JpYW5GYWN0b3J5Lm1hbmRhbG9yaWFuU3ByaXRlKTtcclxuICAgICAgICBjb25zdCBtYW5kYWxvcmlhbiA9IHNjZW5lLmFkZC5jb250YWluZXIoNDAwLCA0MDAsIFttYW5kYWxvcmlhblNwcml0ZV0pLnNldERlcHRoKDEpOyAgICAgICAgXHJcbiAgICAgICAgY29uc3Qgd2VhcG9ucyA9IE1hbmRhbG9yaWFuV2VhcG9uRmFjdG9yeS5jcmVhdGUoc2NlbmUsIG1hbmRhbG9yaWFuKTtcclxuICAgICAgICByZXR1cm4gbmV3IE1hbmRhbG9yaWFuKHttYW5kYWxvcmlhbiwgd2VhcG9ucywga2V5Ym9hcmQsIG1vdXNlfSk7XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQgeyBQaXN0b2wsIFBpc3RvbEZhY3RvcnkgfSBmcm9tIFwiLi9QaXN0b2xcIjtcclxuaW1wb3J0IHsgUm9ja2V0RmFjdG9yeSB9IGZyb20gXCIuL1JvY2tldFwiO1xyXG5pbXBvcnQgeyBSb2NrZXRHdW4sIFJvY2tldEd1bkZhY3RvcnkgfSBmcm9tIFwiLi9Sb2NrZXRHdW5cIjtcclxuaW1wb3J0IHsgU2NlbmUgfSBmcm9tIFwiLi9TY2VuZVwiO1xyXG5cclxuaW50ZXJmYWNlIElQYXJhbXMge1xyXG4gICAgcGlzdG9sOiBQaXN0b2w7XHJcbiAgICByb2NrZXRHdW46IFJvY2tldEd1bjtcclxuICAgIGlucHV0OiBQaGFzZXIuSW5wdXQuSW5wdXRQbHVnaW47XHJcbiAgICBtb3VzZTogUGhhc2VyLklucHV0LlBvaW50ZXI7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBNYW5kYWxvcmlhbldlYXBvbnMge1xyXG4gICAgd2VhcG9uczogSU1hbmRhbG9yaWFuV2VhcG9uW107XHJcbiAgICBhY3RpdmF0ZWQgPSAwO1xyXG4gICAgaXNBdHRhY2s6IGJvb2xlYW47XHJcbiAgICBtb3VzZTogUGhhc2VyLklucHV0LlBvaW50ZXI7XHJcblxyXG4gICAgY29uc3RydWN0b3Ioe3Bpc3RvbCwgcm9ja2V0R3VuLCBpbnB1dCwgbW91c2V9IDogSVBhcmFtcykge1xyXG4gICAgICAgIHRoaXMud2VhcG9ucyA9IFtwaXN0b2wsIHJvY2tldEd1bl07XHJcbiAgICAgICAgdGhpcy5tb3VzZSA9IG1vdXNlO1xyXG5cclxuICAgICAgICB0aGlzLmdldFdlYXBvbigpLnNldEFjdGl2YXRlKHRydWUpO1xyXG5cclxuICAgICAgICBpbnB1dC5vbihQaGFzZXIuSW5wdXQuRXZlbnRzLlBPSU5URVJfRE9XTiwgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmlzQXR0YWNrID0gdHJ1ZTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaW5wdXQub24oUGhhc2VyLklucHV0LkV2ZW50cy5QT0lOVEVSX1VQLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuaXNBdHRhY2sgPSBmYWxzZTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaW5wdXQua2V5Ym9hcmQuYWRkS2V5KCdXJykub24oUGhhc2VyLklucHV0LktleWJvYXJkLkV2ZW50cy5ET1dOLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0V2VhcG9uKCkuc2V0QWN0aXZhdGUoZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCsrdGhpcy5hY3RpdmF0ZWQgPj0gdGhpcy53ZWFwb25zLmxlbmd0aCkgXHJcbiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2YXRlZCA9IDA7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmdldFdlYXBvbigpLnNldEFjdGl2YXRlKHRydWUpO1xyXG4gICAgICAgIH0pOyAgICAgICAgXHJcblxyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZSh0aW1lOiBudW1iZXIsIGRlbHRhOiBudW1iZXIpIHtcclxuICAgICAgICBpZiAodGhpcy5pc0F0dGFjaykge1xyXG4gICAgICAgICAgICB0aGlzLmdldFdlYXBvbigpLmZpcmUodGltZSwgZGVsdGEsIHRoaXMubW91c2UueCwgdGhpcy5tb3VzZS55KVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXRXZWFwb24gPSAoKSA9PiB0aGlzLndlYXBvbnNbdGhpcy5hY3RpdmF0ZWRdO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgTWFuZGFsb3JpYW5XZWFwb25GYWN0b3J5IHtcclxuICAgIHN0YXRpYyBjcmVhdGUoc2NlbmU6IFNjZW5lLCBjb250YWluZXI6IFBoYXNlci5HYW1lT2JqZWN0cy5Db250YWluZXIpIHtcclxuICAgICAgICBjb25zdCBpbnB1dCA9IHNjZW5lLmlucHV0O1xyXG4gICAgICAgIGNvbnN0IG1vdXNlID0gc2NlbmUuaW5wdXQubW91c2VQb2ludGVyO1xyXG4gICAgICAgIGNvbnN0IHBpc3RvbCA9IFBpc3RvbEZhY3RvcnkuY3JlYXRlKHNjZW5lLCBjb250YWluZXIpO1xyXG4gICAgICAgIGNvbnN0IHJvY2tldEd1biA9IFJvY2tldEd1bkZhY3RvcnkuY3JlYXRlKHNjZW5lLCBjb250YWluZXIpOyAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIG5ldyBNYW5kYWxvcmlhbldlYXBvbnMoe3Bpc3RvbCwgcm9ja2V0R3VuLCBpbnB1dCwgbW91c2V9KTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBJTWFuZGFsb3JpYW5XZWFwb24ge1xyXG4gICAgc2V0QWN0aXZhdGUoYWN0aXZhdGVkOiBib29sZWFuKTogdm9pZDtcclxuICAgIGZpcmUodGltZTogbnVtYmVyLCBkZWx0YTogbnVtYmVyLCB4OiBudW1iZXIsIHk6IG51bWJlcik6IHZvaWQ7XHJcbn0iXSwic291cmNlUm9vdCI6IiJ9