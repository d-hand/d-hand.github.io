!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PistolFactory=e.Pistol=void 0;var i=function(){function t(t){var e=this,n=t.pistol,i=t.objectFactory,o=t.mouse;this.lastFired=0,this.isFire=!1,this.isActive=!1,this.activate=function(t){e.isActive=t,e.pistol.setVisible(t)},this.fire=function(t){return e.isFire=t},this.pistol=n,this.objectFactory=i,this.mouse=o}return t.prototype.update=function(t,e){if(this.isActive&&this.isFire&&t>this.lastFired){var n=o.shotSprites[Math.floor(5*Math.random())],i=this.objectFactory.sprite(this.mouse.x,this.mouse.y,n);i.play(n),i.once(Phaser.Animations.Events.SPRITE_ANIMATION_COMPLETE,(function(){return i.destroy()})),this.lastFired=t+800}},t}();e.Pistol=i;var o=function(){function t(){}return t.load=function(e){e.load.image(t.pistol,t.pistol);for(var n=0,i=t.shotSprites;n<i.length;n++){var o=i[n];e.load.spritesheet(o,o,{frameWidth:32,frameHeight:32,endFrame:3})}},t.create=function(e,n){var o=e.input.mousePointer;t.shotSprites.map((function(t){return e.createAnimation({key:t,frames:e.anims.generateFrameNames(t),hideOnComplete:!0})}));var r=e.add.sprite(12,-10,t.pistol).setVisible(!1);return n.add(r),new i({objectFactory:e.add,pistol:r,mouse:o})},t.pistol="assets/pistol.png",t.shotSprites=["assets/pistol-shot.png","assets/pistol-shot-up.png","assets/pistol-shot-right.png","assets/pistol-shot-bottom.png","assets/pistol-shot-left.png"],t}();e.PistolFactory=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RocketGunFactory=e.RocketGun=void 0;var i=n(2),o=function(){function t(t){var e=this,n=t.rocketGun,i=t.rocketGroup,o=t.mouse;this.lastFired=0,this.isFire=!1,this.isActive=!1,this.activate=function(t){e.isActive=t,e.rocketGun.setVisible(t)},this.fire=function(t){return e.isFire=t},this.rocketGun=n,this.rocketGroup=i,this.mouse=o}return t.prototype.update=function(t,e){if(this.isActive&&this.isFire&&t>this.lastFired){var n=this.rocketGroup.get();if(n){var i=this.getAbsolutePosition(),o=i[0],r=i[1];n.activate(o,r,this.mouse.x,this.mouse.y),this.lastFired=t+600}}},t.prototype.getAbsolutePosition=function(){this.rocketGun.getWorldTransformMatrix(t.tempMatrix);var e=t.tempMatrix.decomposeMatrix();return[e.translateX,e.translateY]},t.tempMatrix=new Phaser.GameObjects.Components.TransformMatrix,t}();e.RocketGun=o;var r=function(){function t(){}return t.load=function(e){e.load.image({key:t.image,url:t.image})},t.create=function(e,n){var r=e.input.mousePointer,a=e.add.group({classType:i.Rocket,maxSize:20,runChildUpdate:!0}),s=e.add.sprite(12,-7,t.image).setVisible(!1);return n.add(s),new o({rocketGun:s,rocketGroup:a,mouse:r})},t.image="assets/rocket-gun.png",t}();e.RocketGunFactory=r},function(t,e,n){"use strict";var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.RocketFactory=e.Rocket=void 0;var r=function(t){function e(e){var n=t.call(this,e,0,0,a.rocketImage)||this;return n.displayHeight=7,n.displayWidth=15,n.incX=0,n.incY=0,n.speed=Phaser.Math.GetSpeed(400,1),n}return o(e,t),e.prototype.activate=function(t,e,n,i){this.x1=t,this.y1=e,this.x2=n,this.y2=i,this.setActive(!0),this.setVisible(!0),this.setPosition(t,e);var o=Phaser.Math.Angle.Between(n,i,t,e);this.setRotation(o),this.incX=Math.cos(o),this.incY=Math.sin(o)},e.prototype.update=function(t,e){if(this.x-=this.incX*(this.speed*e),this.y-=this.incY*(this.speed*e),Math.abs(this.x2-this.x1)-Math.abs(this.x-this.x1)<0||Math.abs(this.y2-this.y1)-Math.abs(this.y-this.y1)<0){this.setActive(!1),this.setVisible(!1);var n=this.scene.add.sprite(this.x,this.y,a.explosionSprite);n.setScale(10),n.play(a.explosionSprite),n.once(Phaser.Animations.Events.SPRITE_ANIMATION_COMPLETE,(function(){return n.destroy()})),this.destroy(),console.log("destroy")}},e}(Phaser.GameObjects.Image);e.Rocket=r;var a=function(){function t(){}return t.load=function(e){e.load.image({key:t.rocketImage,url:t.rocketImage}),e.load.spritesheet(t.explosionSprite,t.explosionSprite,{frameWidth:64,frameHeight:64,endFrame:23})},t.addAnimationToScene=function(e){return e.anims.create({key:t.explosionSprite,frames:e.anims.generateFrameNames(t.explosionSprite),hideOnComplete:!0})},t.rocketImage="assets/rocket.png",t.explosionSprite="assets/rocket-explosion.png",t}();e.RocketFactory=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(4);var i=n(6),o={type:Phaser.WEBGL,width:800,height:600,backgroundColor:"#2d2d2d",scene:i.Scene};new Phaser.Game(o)},function(t,e,n){t.exports=n(5)(1)},function(t,e){t.exports=vendor},function(t,e,n){"use strict";var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.Scene=void 0;var r=n(7),a=n(2),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.preload=function(){a.RocketFactory.load(this),r.MandalorianFactory.load(this)},e.prototype.create=function(){a.RocketFactory.addAnimationToScene(this),this.mandalorian=r.MandalorianFactory.create(this)},e.prototype.update=function(t,e){this.mandalorian.update(t,e)},e.prototype.createAnimation=function(t){var e=this.anims.create(t);if(!1===e)throw new Error("Не удалось созать анимацию "+t.key);return e},e}(Phaser.Scene);e.Scene=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MandalorianFactory=e.Mandalorian=void 0;var i=n(8),o=n(0),r=n(1),a=function(){function t(t){var e=t.mandalorian,n=t.weapons,i=t.keyboard,o=t.mouse;this.speed=Phaser.Math.GetSpeed(100,1),this.mandalorian=e,this.weapons=n,this.mouse=o,this.up=[i.addKey("up"),i.addKey("E")],this.left=[i.addKey("left"),i.addKey("S")],this.bottom=[i.addKey("down"),i.addKey("D")],this.right=[i.addKey("right"),i.addKey("F")]}return t.prototype.update=function(t,e){this.weapons.update(t,e),this.mandalorian.x+=e*this.speed*(Number(this.right.some((function(t){return t.isDown})))-Number(this.left.some((function(t){return t.isDown})))),this.mandalorian.y+=e*this.speed*(Number(this.bottom.some((function(t){return t.isDown})))-Number(this.up.some((function(t){return t.isDown})))),this.mandalorian.setRotation(Phaser.Math.Angle.Between(this.mouse.x,this.mouse.y,this.mandalorian.x,this.mandalorian.y)-Math.PI/2)},t}();e.Mandalorian=a;var s=function(){function t(){}return t.load=function(e){o.PistolFactory.load(e),r.RocketGunFactory.load(e),e.load.image(t.mandalorianSprite,"assets/mandalorian.png")},t.create=function(e){var n=e.input.keyboard,o=e.input.mousePointer,r=e.add.sprite(0,0,t.mandalorianSprite),s=e.add.container(400,400,[r]).setDepth(1),c=i.MandalorianWeaponFactory.create(e,s);return new a({mandalorian:s,weapons:c,keyboard:n,mouse:o})},t.mandalorianSprite="mandalorianSprite",t}();e.MandalorianFactory=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MandalorianWeaponFactory=e.MandalorianWeapons=void 0;var i=n(0),o=n(1),r=function(){function t(t){var e=this,n=t.pistol,i=t.rocketGun,o=t.input;this.activeIndex=0,this.getWeapon=function(){return e.weapons[e.activeIndex]},this.switchWeapons=function(){e.getWeapon().activate(!1),e.switchIndex(),e.getWeapon().activate(!0)},this.weapons=[n,i],o.keyboard.addKey("W").on(Phaser.Input.Keyboard.Events.DOWN,this.switchWeapons),o.keyboard.addKey("CTRL").on(Phaser.Input.Keyboard.Events.DOWN,this.switchWeapons),o.on(Phaser.Input.Events.POINTER_DOWN,(function(){return e.fire(!0)})),o.on(Phaser.Input.Events.POINTER_UP,(function(){return e.fire(!1)})),this.getWeapon().activate(!0)}return t.prototype.update=function(t,e){this.weapons.forEach((function(n){return n.update(t,e)}))},t.prototype.fire=function(t){this.getWeapon().fire(t)},t.prototype.switchIndex=function(){++this.activeIndex>=this.weapons.length&&(this.activeIndex=0)},t}();e.MandalorianWeapons=r;var a=function(){function t(){}return t.create=function(t,e){var n=t.input,a=i.PistolFactory.create(t,e),s=o.RocketGunFactory.create(t,e);return new r({pistol:a,rocketGun:s,input:n})},t}();e.MandalorianWeaponFactory=a}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL1Bpc3RvbC50cyIsIndlYnBhY2s6Ly8vLi9zcmMvUm9ja2V0R3VuLnRzIiwid2VicGFjazovLy8uL3NyYy9Sb2NrZXQudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL0dhbWUudHMiLCJ3ZWJwYWNrOi8vL2RlbGVnYXRlZCAuL25vZGVfbW9kdWxlcy9waGFzZXIvZGlzdC9waGFzZXIuanMgZnJvbSBkbGwtcmVmZXJlbmNlIHZlbmRvciIsIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCJ2ZW5kb3JcIiIsIndlYnBhY2s6Ly8vLi9zcmMvU2NlbmUudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL01hbmRhbG9yaWFuLnRzIiwid2VicGFjazovLy8uL3NyYy9NYW5kYWxvcmlhbldlYXBvbnMudHMiXSwibmFtZXMiOlsiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJwaXN0b2wiLCJvYmplY3RGYWN0b3J5IiwibW91c2UiLCJsYXN0RmlyZWQiLCJpc0ZpcmUiLCJpc0FjdGl2ZSIsImFjdGl2YXRlIiwic2V0VmlzaWJsZSIsImZpcmUiLCJ0aGlzIiwidXBkYXRlIiwidGltZSIsImRlbHRhIiwic3ByaXRlTmFtZSIsIlBpc3RvbEZhY3RvcnkiLCJzaG90U3ByaXRlcyIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInNwcml0ZSIsIngiLCJ5IiwicGxheSIsIm9uY2UiLCJQaGFzZXIiLCJBbmltYXRpb25zIiwiRXZlbnRzIiwiU1BSSVRFX0FOSU1BVElPTl9DT01QTEVURSIsImRlc3Ryb3kiLCJQaXN0b2wiLCJsb2FkIiwic2NlbmUiLCJpbWFnZSIsInNwcml0ZXNoZWV0IiwiZnJhbWVXaWR0aCIsImZyYW1lSGVpZ2h0IiwiZW5kRnJhbWUiLCJjb250YWluZXIiLCJpbnB1dCIsIm1vdXNlUG9pbnRlciIsIm1hcCIsImNyZWF0ZUFuaW1hdGlvbiIsImZyYW1lcyIsImFuaW1zIiwiZ2VuZXJhdGVGcmFtZU5hbWVzIiwiaGlkZU9uQ29tcGxldGUiLCJhZGQiLCJyb2NrZXRHdW4iLCJyb2NrZXRHcm91cCIsInJvY2tldCIsImdldEFic29sdXRlUG9zaXRpb24iLCJnZXRXb3JsZFRyYW5zZm9ybU1hdHJpeCIsIlJvY2tldEd1biIsInRlbXBNYXRyaXgiLCJkZWNvbXBvc2VNYXRyaXgiLCJ0cmFuc2xhdGVYIiwidHJhbnNsYXRlWSIsIkdhbWVPYmplY3RzIiwiQ29tcG9uZW50cyIsIlRyYW5zZm9ybU1hdHJpeCIsIlJvY2tldEd1bkZhY3RvcnkiLCJ1cmwiLCJncm91cCIsImNsYXNzVHlwZSIsIlJvY2tldCIsIm1heFNpemUiLCJydW5DaGlsZFVwZGF0ZSIsIlJvY2tldEZhY3RvcnkiLCJyb2NrZXRJbWFnZSIsImRpc3BsYXlIZWlnaHQiLCJkaXNwbGF5V2lkdGgiLCJpbmNYIiwiaW5jWSIsInNwZWVkIiwiR2V0U3BlZWQiLCJ4MSIsInkxIiwieDIiLCJ5MiIsInNldEFjdGl2ZSIsInNldFBvc2l0aW9uIiwiYW5nbGUiLCJBbmdsZSIsIkJldHdlZW4iLCJzZXRSb3RhdGlvbiIsImNvcyIsInNpbiIsImFicyIsImV4cGxvc2lvblNwcml0ZSIsInNldFNjYWxlIiwiY29uc29sZSIsImxvZyIsIkltYWdlIiwiYWRkQW5pbWF0aW9uVG9TY2VuZSIsImNvbmZpZyIsInR5cGUiLCJXRUJHTCIsIndpZHRoIiwiaGVpZ2h0IiwiYmFja2dyb3VuZENvbG9yIiwiU2NlbmUiLCJHYW1lIiwidmVuZG9yIiwicHJlbG9hZCIsIk1hbmRhbG9yaWFuRmFjdG9yeSIsIm1hbmRhbG9yaWFuIiwicmVzdWx0IiwiRXJyb3IiLCJ3ZWFwb25zIiwia2V5Ym9hcmQiLCJ1cCIsImFkZEtleSIsImxlZnQiLCJib3R0b20iLCJyaWdodCIsIk51bWJlciIsInNvbWUiLCJpc0Rvd24iLCJQSSIsIk1hbmRhbG9yaWFuIiwibWFuZGFsb3JpYW5TcHJpdGUiLCJzZXREZXB0aCIsIk1hbmRhbG9yaWFuV2VhcG9uRmFjdG9yeSIsImFjdGl2ZUluZGV4IiwiZ2V0V2VhcG9uIiwic3dpdGNoV2VhcG9ucyIsInN3aXRjaEluZGV4Iiwib24iLCJJbnB1dCIsIktleWJvYXJkIiwiRE9XTiIsIlBPSU5URVJfRE9XTiIsIlBPSU5URVJfVVAiLCJmb3JFYWNoIiwidyIsImxlbmd0aCIsIk1hbmRhbG9yaWFuV2VhcG9ucyJdLCJtYXBwaW5ncyI6ImFBQ0UsSUFBSUEsRUFBbUIsR0FHdkIsU0FBU0MsRUFBb0JDLEdBRzVCLEdBQUdGLEVBQWlCRSxHQUNuQixPQUFPRixFQUFpQkUsR0FBVUMsUUFHbkMsSUFBSUMsRUFBU0osRUFBaUJFLEdBQVksQ0FDekNHLEVBQUdILEVBQ0hJLEdBQUcsRUFDSEgsUUFBUyxJQVVWLE9BTkFJLEVBQVFMLEdBQVVNLEtBQUtKLEVBQU9ELFFBQVNDLEVBQVFBLEVBQU9ELFFBQVNGLEdBRy9ERyxFQUFPRSxHQUFJLEVBR0pGLEVBQU9ELFFBS2ZGLEVBQW9CUSxFQUFJRixFQUd4Qk4sRUFBb0JTLEVBQUlWLEVBR3hCQyxFQUFvQlUsRUFBSSxTQUFTUixFQUFTUyxFQUFNQyxHQUMzQ1osRUFBb0JhLEVBQUVYLEVBQVNTLElBQ2xDRyxPQUFPQyxlQUFlYixFQUFTUyxFQUFNLENBQUVLLFlBQVksRUFBTUMsSUFBS0wsS0FLaEVaLEVBQW9Ca0IsRUFBSSxTQUFTaEIsR0FDWCxvQkFBWGlCLFFBQTBCQSxPQUFPQyxhQUMxQ04s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QUFHdkcsT0FBT3dHLE1BQU10RyxPQUFPMEcsWUFBWSxXQUFNLFNBQUs1SCxNQUFLLE1BRXpEQyxLQUFLbUgsWUFBWXRILFVBQVMsR0F1QmxDLE9BcEJJLFlBQUFJLE9BQUEsU0FBT0MsRUFBY0MsR0FDakJILEtBQUttRyxRQUFReUIsU0FBUSxTQUFBQyxHQUFLLE9BQUFBLEVBQUU1SCxPQUFPQyxFQUFNQyxPQUc3QyxZQUFBSixLQUFBLFNBQUtKLEdBQ0RLLEtBQUttSCxZQUFZcEgsS0FBS0osSUFXMUIsWUFBQTBILFlBQUEsYUFDVXJILEtBQUtrSCxhQUFlbEgsS0FBS21HLFFBQVEyQixTQUNuQzlILEtBQUtrSCxZQUFjLElBRS9CLEVBckNBLEdBQWEsRUFBQWEscUJBdUNiLCtCQVFBLE9BUFcsRUFBQWxKLE9BQVAsU0FBY3lDLEVBQWNNLEdBQ3hCLElBQU1DLEVBQVFQLEVBQU1PLE1BRWR0QyxFQUFTLEVBQUFjLGNBQWN4QixPQUFPeUMsRUFBT00sR0FDckNVLEVBQVksRUFBQWEsaUJBQWlCdEUsT0FBT3lDLEVBQU9NLEdBQ2pELE9BQU8sSUFBSW1HLEVBQW1CLENBQUN4SSxPQUFNLEVBQUUrQyxVQUFTLEVBQUVULE1BQUssS0FFL0QsRUFSQSxHQUFhLEVBQUFvRiIsImZpbGUiOiJnYW1lLmJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAzKTtcbiIsImltcG9ydCB7IFBhaXJGYWN0b3J5IH0gZnJvbSBcIm1hdHRlclwiO1xyXG5pbXBvcnQgeyBJTWFuZGFsb3JpYW5XZWFwb24gfSBmcm9tIFwiLi9NYW5kYWxvcmlhbldlYXBvbnNcIjtcclxuaW1wb3J0IHsgU2NlbmUgfSBmcm9tIFwiLi9TY2VuZVwiO1xyXG5cclxuaW50ZXJmYWNlIElQYXJhbXMge1xyXG4gICAgcGlzdG9sOiBQaGFzZXIuR2FtZU9iamVjdHMuU3ByaXRlO1xyXG4gICAgb2JqZWN0RmFjdG9yeTogUGhhc2VyLkdhbWVPYmplY3RzLkdhbWVPYmplY3RGYWN0b3J5O1xyXG4gICAgbW91c2U6IFBoYXNlci5JbnB1dC5Qb2ludGVyO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgUGlzdG9sIGltcGxlbWVudHMgSU1hbmRhbG9yaWFuV2VhcG9uIHtcclxuICAgIHBpc3RvbDogUGhhc2VyLkdhbWVPYmplY3RzLlNwcml0ZTtcclxuICAgIG9iamVjdEZhY3Rvcnk6IFBoYXNlci5HYW1lT2JqZWN0cy5HYW1lT2JqZWN0RmFjdG9yeTtcclxuICAgIG1vdXNlOiBQaGFzZXIuSW5wdXQuUG9pbnRlcjtcclxuICAgIGxhc3RGaXJlZCA9IDA7XHJcbiAgICBpc0ZpcmUgPSBmYWxzZTtcclxuICAgIGlzQWN0aXZlID0gZmFsc2U7XHJcblxyXG4gICAgY29uc3RydWN0b3Ioe3Bpc3RvbCwgb2JqZWN0RmFjdG9yeSwgbW91c2V9IDogSVBhcmFtcykge1xyXG4gICAgICAgIHRoaXMucGlzdG9sID0gcGlzdG9sO1xyXG4gICAgICAgIHRoaXMub2JqZWN0RmFjdG9yeSA9IG9iamVjdEZhY3Rvcnk7XHJcbiAgICAgICAgdGhpcy5tb3VzZSA9IG1vdXNlO1xyXG4gICAgfVxyXG5cclxuICAgIGFjdGl2YXRlID0gKGlzQWN0aXZlOiBib29sZWFuKSA9PiB7XHJcbiAgICAgICAgdGhpcy5pc0FjdGl2ZSA9IGlzQWN0aXZlO1xyXG4gICAgICAgIHRoaXMucGlzdG9sLnNldFZpc2libGUoaXNBY3RpdmUpOyAgICAgICAgXHJcbiAgICB9XHJcblxyXG5cclxuICAgIGZpcmUgPSAoaXNGaXJlOiBib29sZWFuKSA9PiB0aGlzLmlzRmlyZSA9IGlzRmlyZTtcclxuXHJcbiAgICB1cGRhdGUodGltZTogbnVtYmVyLCBkZWx0YTogbnVtYmVyKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNBY3RpdmUgJiYgdGhpcy5pc0ZpcmUgJiYgdGltZSA+IHRoaXMubGFzdEZpcmVkKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNwcml0ZU5hbWUgPSBQaXN0b2xGYWN0b3J5LnNob3RTcHJpdGVzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDUpXTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHNob3RTcHJpdGUgPSB0aGlzLm9iamVjdEZhY3Rvcnkuc3ByaXRlKHRoaXMubW91c2UueCwgdGhpcy5tb3VzZS55LCBzcHJpdGVOYW1lKTtcclxuICAgICAgICAgICAgc2hvdFNwcml0ZS5wbGF5KHNwcml0ZU5hbWUpO1xyXG4gICAgICAgICAgICBzaG90U3ByaXRlLm9uY2UoUGhhc2VyLkFuaW1hdGlvbnMuRXZlbnRzLlNQUklURV9BTklNQVRJT05fQ09NUExFVEUsICgpID0+IHNob3RTcHJpdGUuZGVzdHJveSgpKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMubGFzdEZpcmVkID0gdGltZSArIDgwMDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBQaXN0b2xGYWN0b3J5IHtcclxuICAgIHN0YXRpYyByZWFkb25seSBwaXN0b2wgPSAnYXNzZXRzL3Bpc3RvbC5wbmcnO1xyXG5cclxuICAgIHN0YXRpYyByZWFkb25seSBzaG90U3ByaXRlcyA9IFtcclxuICAgICAgICAnYXNzZXRzL3Bpc3RvbC1zaG90LnBuZycsXHJcbiAgICAgICAgJ2Fzc2V0cy9waXN0b2wtc2hvdC11cC5wbmcnLFxyXG4gICAgICAgICdhc3NldHMvcGlzdG9sLXNob3QtcmlnaHQucG5nJyxcclxuICAgICAgICAnYXNzZXRzL3Bpc3RvbC1zaG90LWJvdHRvbS5wbmcnLFxyXG4gICAgICAgICdhc3NldHMvcGlzdG9sLXNob3QtbGVmdC5wbmcnXHJcbiAgICBdO1xyXG5cclxuICAgIHN0YXRpYyBsb2FkKHNjZW5lOiBTY2VuZSkge1xyXG4gICAgICAgIHNjZW5lLmxvYWQuaW1hZ2UoUGlzdG9sRmFjdG9yeS5waXN0b2wsIFBpc3RvbEZhY3RvcnkucGlzdG9sKTtcclxuXHJcbiAgICAgICAgZm9yICh2YXIgc3ByaXRlIG9mIFBpc3RvbEZhY3Rvcnkuc2hvdFNwcml0ZXMpXHJcbiAgICAgICAgICAgIHNjZW5lLmxvYWQuc3ByaXRlc2hlZXQoc3ByaXRlLCBzcHJpdGUsIHsgZnJhbWVXaWR0aDogMzIsIGZyYW1lSGVpZ2h0OiAzMiwgZW5kRnJhbWU6IDMgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGNyZWF0ZShzY2VuZTogU2NlbmUsIGNvbnRhaW5lcjogUGhhc2VyLkdhbWVPYmplY3RzLkNvbnRhaW5lcikge1xyXG4gICAgICAgIGNvbnN0IG1vdXNlID0gc2NlbmUuaW5wdXQubW91c2VQb2ludGVyO1xyXG5cclxuICAgICAgICBQaXN0b2xGYWN0b3J5LnNob3RTcHJpdGVzLm1hcChzcHJpdGUgPT4gc2NlbmUuY3JlYXRlQW5pbWF0aW9uKHtcclxuICAgICAgICAgICAga2V5OiBzcHJpdGUsXHJcbiAgICAgICAgICAgIGZyYW1lczogc2NlbmUuYW5pbXMuZ2VuZXJhdGVGcmFtZU5hbWVzKHNwcml0ZSksXHJcbiAgICAgICAgICAgIGhpZGVPbkNvbXBsZXRlOiB0cnVlLFxyXG4gICAgICAgIH0pKTtcclxuXHJcbiAgICAgICAgY29uc3QgcGlzdG9sID0gc2NlbmUuYWRkLnNwcml0ZSgxMiwgLTEwLCBQaXN0b2xGYWN0b3J5LnBpc3RvbCkuc2V0VmlzaWJsZShmYWxzZSk7XHJcbiAgICAgICAgY29udGFpbmVyLmFkZChwaXN0b2wpO1xyXG5cclxuICAgICAgICByZXR1cm4gbmV3IFBpc3RvbCh7b2JqZWN0RmFjdG9yeTogc2NlbmUuYWRkLCBwaXN0b2wsIG1vdXNlfSk7XHJcbiAgICB9XHJcbn1cclxuIiwiaW1wb3J0IHsgSU1hbmRhbG9yaWFuV2VhcG9uIH0gZnJvbSBcIi4vTWFuZGFsb3JpYW5XZWFwb25zXCI7XHJcbmltcG9ydCB7IFJvY2tldCB9IGZyb20gXCIuL1JvY2tldFwiO1xyXG5pbXBvcnQgeyBTY2VuZSB9IGZyb20gXCIuL1NjZW5lXCI7XHJcblxyXG5pbnRlcmZhY2UgSVBhcmFtcyB7XHJcbiAgICByb2NrZXRHdW46IFBoYXNlci5HYW1lT2JqZWN0cy5TcHJpdGU7XHJcbiAgICByb2NrZXRHcm91cDogUGhhc2VyLkdhbWVPYmplY3RzLkdyb3VwO1xyXG4gICAgbW91c2U6IFBoYXNlci5JbnB1dC5Qb2ludGVyO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgUm9ja2V0R3VuIGltcGxlbWVudHMgSU1hbmRhbG9yaWFuV2VhcG9uIHtcclxuICAgIHN0YXRpYyB0ZW1wTWF0cml4ID0gbmV3IFBoYXNlci5HYW1lT2JqZWN0cy5Db21wb25lbnRzLlRyYW5zZm9ybU1hdHJpeCgpO1xyXG5cclxuICAgIG1vdXNlOiBQaGFzZXIuSW5wdXQuUG9pbnRlcjtcclxuICAgIHJvY2tldEd1bjogUGhhc2VyLkdhbWVPYmplY3RzLlNwcml0ZTtcclxuICAgIHJvY2tldEdyb3VwOiBQaGFzZXIuR2FtZU9iamVjdHMuR3JvdXA7XHJcbiAgICBsYXN0RmlyZWQgPSAwO1xyXG4gICAgaXNGaXJlID0gZmFsc2U7XHJcbiAgICBpc0FjdGl2ZSA9IGZhbHNlO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHtyb2NrZXRHdW4sIHJvY2tldEdyb3VwLCBtb3VzZX0gOiBJUGFyYW1zKSB7XHJcbiAgICAgICAgdGhpcy5yb2NrZXRHdW4gPSByb2NrZXRHdW47XHJcbiAgICAgICAgdGhpcy5yb2NrZXRHcm91cCA9IHJvY2tldEdyb3VwO1xyXG4gICAgICAgIHRoaXMubW91c2UgPSBtb3VzZTtcclxuICAgIH1cclxuXHJcbiAgICBhY3RpdmF0ZSA9IChpc0FjdGl2ZTogYm9vbGVhbikgPT4ge1xyXG4gICAgICAgIHRoaXMuaXNBY3RpdmUgPSBpc0FjdGl2ZTtcclxuICAgICAgICB0aGlzLnJvY2tldEd1bi5zZXRWaXNpYmxlKGlzQWN0aXZlKTtcclxuICAgIH1cclxuXHJcbiAgICBmaXJlID0gKGlzRmlyZTogYm9vbGVhbikgPT4gdGhpcy5pc0ZpcmUgPSBpc0ZpcmU7XHJcblxyXG4gICAgdXBkYXRlKHRpbWU6IG51bWJlciwgZGVsdGE6IG51bWJlcikge1xyXG4gICAgICAgIGlmICh0aGlzLmlzQWN0aXZlICYmIHRoaXMuaXNGaXJlICYmIHRpbWUgPiB0aGlzLmxhc3RGaXJlZCkge1xyXG4gICAgICAgICAgICB2YXIgcm9ja2V0ID0gdGhpcy5yb2NrZXRHcm91cC5nZXQoKSBhcyBSb2NrZXQ7XHJcblxyXG4gICAgICAgICAgICBpZiAocm9ja2V0KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBbeCwgeV0gPSB0aGlzLmdldEFic29sdXRlUG9zaXRpb24oKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgcm9ja2V0LmFjdGl2YXRlKHgsIHksIHRoaXMubW91c2UueCwgdGhpcy5tb3VzZS55KTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLmxhc3RGaXJlZCA9IHRpbWUgKyA2MDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0QWJzb2x1dGVQb3NpdGlvbigpIHtcclxuICAgICAgICB0aGlzLnJvY2tldEd1bi5nZXRXb3JsZFRyYW5zZm9ybU1hdHJpeChSb2NrZXRHdW4udGVtcE1hdHJpeCk7XHJcbiAgICAgICAgdmFyIGQgPSBSb2NrZXRHdW4udGVtcE1hdHJpeC5kZWNvbXBvc2VNYXRyaXgoKSBhcyBhbnk7ICAgICAgICBcclxuICAgICAgICByZXR1cm4gW2QudHJhbnNsYXRlWCwgZC50cmFuc2xhdGVZXVxyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgUm9ja2V0R3VuRmFjdG9yeSB7XHJcbiAgICBzdGF0aWMgcmVhZG9ubHkgaW1hZ2UgPSAnYXNzZXRzL3JvY2tldC1ndW4ucG5nJztcclxuXHJcbiAgICBzdGF0aWMgbG9hZChzY2VuZTogU2NlbmUpIHtcclxuICAgICAgICBzY2VuZS5sb2FkLmltYWdlKHtcclxuICAgICAgICAgICAga2V5OiBSb2NrZXRHdW5GYWN0b3J5LmltYWdlLFxyXG4gICAgICAgICAgICB1cmw6IFJvY2tldEd1bkZhY3RvcnkuaW1hZ2UsXHJcbiAgICAgICAgfSk7ICAgICAgICBcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgY3JlYXRlKHNjZW5lOiBTY2VuZSwgY29udGFpbmVyOiBQaGFzZXIuR2FtZU9iamVjdHMuQ29udGFpbmVyKSB7XHJcbiAgICAgICAgY29uc3QgbW91c2UgPSBzY2VuZS5pbnB1dC5tb3VzZVBvaW50ZXI7XHJcblxyXG4gICAgICAgIGNvbnN0IHJvY2tldEdyb3VwID0gc2NlbmUuYWRkLmdyb3VwKHtcclxuICAgICAgICAgICAgY2xhc3NUeXBlOiBSb2NrZXQsXHJcbiAgICAgICAgICAgIG1heFNpemU6IDIwLFxyXG4gICAgICAgICAgICBydW5DaGlsZFVwZGF0ZTogdHJ1ZVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCByb2NrZXRHdW4gPSBzY2VuZS5hZGQuc3ByaXRlKDEyLCAtNywgUm9ja2V0R3VuRmFjdG9yeS5pbWFnZSkuc2V0VmlzaWJsZShmYWxzZSk7XHJcbiAgICAgICAgY29udGFpbmVyLmFkZChyb2NrZXRHdW4pO1xyXG5cclxuXHJcbiAgICAgICAgcmV0dXJuIG5ldyBSb2NrZXRHdW4oe3JvY2tldEd1biwgcm9ja2V0R3JvdXAsIG1vdXNlfSk7XHJcbiAgICB9XHJcbn1cclxuIiwiaW1wb3J0IHsgU2NlbmUgfSBmcm9tIFwiLi9TY2VuZVwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFJvY2tldCBleHRlbmRzIFBoYXNlci5HYW1lT2JqZWN0cy5JbWFnZSB7XHJcbiAgICBpbmNYOiBudW1iZXI7XHJcbiAgICBpbmNZOiBudW1iZXI7XHJcbiAgICB4MTogbnVtYmVyO1xyXG4gICAgeTE6IG51bWJlcjtcclxuICAgIHgyOiBudW1iZXI7XHJcbiAgICB5MjogbnVtYmVyO1xyXG4gICAgc3BlZWQ6IG51bWJlcjtcclxuICAgIGJvb21TcHJpdGU6IFBoYXNlci5HYW1lT2JqZWN0cy5TcHJpdGU7XHJcblxyXG4gICAgY29uc3RydWN0b3Ioc2NlbmU6IFNjZW5lKSB7XHJcbiAgICAgICAgc3VwZXIoc2NlbmUsIDAsIDAsIFJvY2tldEZhY3Rvcnkucm9ja2V0SW1hZ2UpO1xyXG5cclxuICAgICAgICB0aGlzLmRpc3BsYXlIZWlnaHQgPSA3O1xyXG4gICAgICAgIHRoaXMuZGlzcGxheVdpZHRoID0gMTU7XHJcbiAgICAgICAgdGhpcy5pbmNYID0gMDtcclxuICAgICAgICB0aGlzLmluY1kgPSAwO1xyXG4gICAgICAgIHRoaXMuc3BlZWQgPSBQaGFzZXIuTWF0aC5HZXRTcGVlZCg0MDAsIDEpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBhY3RpdmF0ZSh4MTogbnVtYmVyLCB5MTogbnVtYmVyLCB4MjogbnVtYmVyLCB5MjogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy54MSA9IHgxO1xyXG4gICAgICAgIHRoaXMueTEgPSB5MTtcclxuICAgICAgICB0aGlzLngyID0geDI7XHJcbiAgICAgICAgdGhpcy55MiA9IHkyO1xyXG5cclxuICAgICAgICB0aGlzLnNldEFjdGl2ZSh0cnVlKTtcclxuICAgICAgICB0aGlzLnNldFZpc2libGUodHJ1ZSk7XHJcblxyXG4gICAgICAgIHRoaXMuc2V0UG9zaXRpb24oeDEsIHkxKTtcclxuXHJcbiAgICAgICAgdmFyIGFuZ2xlID0gUGhhc2VyLk1hdGguQW5nbGUuQmV0d2Vlbih4MiwgeTIsIHgxLCB5MSk7XHJcblxyXG4gICAgICAgIHRoaXMuc2V0Um90YXRpb24oYW5nbGUpO1xyXG5cclxuICAgICAgICB0aGlzLmluY1ggPSBNYXRoLmNvcyhhbmdsZSk7XHJcbiAgICAgICAgdGhpcy5pbmNZID0gTWF0aC5zaW4oYW5nbGUpO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZSh0aW1lOiBudW1iZXIsIGRlbHRhOiBudW1iZXIpIHtcclxuXHJcbiAgICAgICAgdGhpcy54IC09IHRoaXMuaW5jWCAqICh0aGlzLnNwZWVkICogZGVsdGEpO1xyXG4gICAgICAgIHRoaXMueSAtPSB0aGlzLmluY1kgKiAodGhpcy5zcGVlZCAqIGRlbHRhKTtcclxuXHJcbiAgICAgICAgaWYgKE1hdGguYWJzKHRoaXMueDIgLSB0aGlzLngxKSAtIE1hdGguYWJzKHRoaXMueCAtIHRoaXMueDEpIDwgMCB8fFxyXG4gICAgICAgICAgICBNYXRoLmFicyh0aGlzLnkyIC0gdGhpcy55MSkgLSBNYXRoLmFicyh0aGlzLnkgLSB0aGlzLnkxKSA8IDApIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRBY3RpdmUoZmFsc2UpO1xyXG4gICAgICAgICAgICB0aGlzLnNldFZpc2libGUoZmFsc2UpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgZXhwbG9zaW9uU3ByaXRlID0gdGhpcy5zY2VuZS5hZGQuc3ByaXRlKHRoaXMueCwgdGhpcy55LCBSb2NrZXRGYWN0b3J5LmV4cGxvc2lvblNwcml0ZSk7ICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGxvc2lvblNwcml0ZS5zZXRTY2FsZSgxMClcclxuICAgICAgICAgICAgZXhwbG9zaW9uU3ByaXRlLnBsYXkoUm9ja2V0RmFjdG9yeS5leHBsb3Npb25TcHJpdGUpO1xyXG4gICAgICAgICAgICBleHBsb3Npb25TcHJpdGUub25jZShQaGFzZXIuQW5pbWF0aW9ucy5FdmVudHMuU1BSSVRFX0FOSU1BVElPTl9DT01QTEVURSwgKCkgPT4gZXhwbG9zaW9uU3ByaXRlLmRlc3Ryb3koKSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB0aGlzLmRlc3Ryb3koKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdkZXN0cm95Jyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgUm9ja2V0RmFjdG9yeSB7XHJcbiAgICBzdGF0aWMgcmVhZG9ubHkgcm9ja2V0SW1hZ2UgPSAnYXNzZXRzL3JvY2tldC5wbmcnO1xyXG4gICAgc3RhdGljIHJlYWRvbmx5IGV4cGxvc2lvblNwcml0ZSA9ICdhc3NldHMvcm9ja2V0LWV4cGxvc2lvbi5wbmcnO1xyXG5cclxuICAgIHN0YXRpYyBsb2FkKHNjZW5lOiBTY2VuZSkge1xyXG4gICAgICAgIHNjZW5lLmxvYWQuaW1hZ2Uoe1xyXG4gICAgICAgICAgICBrZXk6IFJvY2tldEZhY3Rvcnkucm9ja2V0SW1hZ2UsXHJcbiAgICAgICAgICAgIHVybDogUm9ja2V0RmFjdG9yeS5yb2NrZXRJbWFnZSxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgc2NlbmUubG9hZC5zcHJpdGVzaGVldChSb2NrZXRGYWN0b3J5LmV4cGxvc2lvblNwcml0ZSwgUm9ja2V0RmFjdG9yeS5leHBsb3Npb25TcHJpdGUsIHsgZnJhbWVXaWR0aDogNjQsIGZyYW1lSGVpZ2h0OiA2NCwgZW5kRnJhbWU6IDIzIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBhZGRBbmltYXRpb25Ub1NjZW5lKHNjZW5lOiBTY2VuZSkge1xyXG4gICAgICAgIHJldHVybiBzY2VuZS5hbmltcy5jcmVhdGUoe1xyXG4gICAgICAgICAgICBrZXk6IFJvY2tldEZhY3RvcnkuZXhwbG9zaW9uU3ByaXRlLFxyXG4gICAgICAgICAgICBmcmFtZXM6IHNjZW5lLmFuaW1zLmdlbmVyYXRlRnJhbWVOYW1lcyhSb2NrZXRGYWN0b3J5LmV4cGxvc2lvblNwcml0ZSksXHJcbiAgICAgICAgICAgIGhpZGVPbkNvbXBsZXRlOiB0cnVlLFxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcblxyXG4iLCJpbXBvcnQgJ3BoYXNlcic7XHJcbmltcG9ydCB7U2NlbmV9IGZyb20gJy4vU2NlbmUnO1xyXG5cclxuY29uc3QgY29uZmlnID0ge1xyXG4gICAgdHlwZTogUGhhc2VyLldFQkdMLFxyXG4gICAgd2lkdGg6IDgwMCxcclxuICAgIGhlaWdodDogNjAwLFxyXG4gICAgYmFja2dyb3VuZENvbG9yOiAnIzJkMmQyZCcsXHJcbiAgICBzY2VuZTogU2NlbmVcclxufTtcclxuXHJcbmNvbnN0IGdhbWUgPSBuZXcgUGhhc2VyLkdhbWUoY29uZmlnKTtcclxuIiwibW9kdWxlLmV4cG9ydHMgPSAoX193ZWJwYWNrX3JlcXVpcmVfXyg1KSkoMSk7IiwibW9kdWxlLmV4cG9ydHMgPSB2ZW5kb3I7IiwiaW1wb3J0IHsgTWFuZGFsb3JpYW4sIE1hbmRhbG9yaWFuRmFjdG9yeSB9IGZyb20gJy4vTWFuZGFsb3JpYW4nO1xyXG5pbXBvcnQgeyBSb2NrZXRGYWN0b3J5IH0gZnJvbSAnLi9Sb2NrZXQnO1xyXG5cclxuZXhwb3J0IGNsYXNzIFNjZW5lIGV4dGVuZHMgUGhhc2VyLlNjZW5lIHsgICAgXHJcbiAgICBtYW5kYWxvcmlhbjogTWFuZGFsb3JpYW47XHJcblxyXG4gICAgcHJlbG9hZCgpIHsgICAgICAgIFxyXG4gICAgICAgIFJvY2tldEZhY3RvcnkubG9hZCh0aGlzKTtcclxuICAgICAgICBNYW5kYWxvcmlhbkZhY3RvcnkubG9hZCh0aGlzKTtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGUoKSB7XHJcbiAgICAgICAgUm9ja2V0RmFjdG9yeS5hZGRBbmltYXRpb25Ub1NjZW5lKHRoaXMpO1xyXG4gICAgICAgIHRoaXMubWFuZGFsb3JpYW4gPSBNYW5kYWxvcmlhbkZhY3RvcnkuY3JlYXRlKHRoaXMpO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZSh0aW1lOiBudW1iZXIsIGRlbHRhOiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLm1hbmRhbG9yaWFuLnVwZGF0ZSh0aW1lLCBkZWx0YSk7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlQW5pbWF0aW9uKGNvbmZpZzogUGhhc2VyLlR5cGVzLkFuaW1hdGlvbnMuQW5pbWF0aW9uKSB7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IHRoaXMuYW5pbXMuY3JlYXRlKGNvbmZpZyk7XHJcbiAgICAgICAgaWYgKHJlc3VsdCA9PT0gZmFsc2UpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihg0J3QtSDRg9C00LDQu9C+0YHRjCDRgdC+0LfQsNGC0Ywg0LDQvdC40LzQsNGG0LjRjiAke2NvbmZpZy5rZXl9YClcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxufSIsImltcG9ydCB7IE1hbmRhbG9yaWFuV2VhcG9uRmFjdG9yeSwgTWFuZGFsb3JpYW5XZWFwb25zIH0gZnJvbSBcIi4vTWFuZGFsb3JpYW5XZWFwb25zXCI7XHJcbmltcG9ydCB7IFBpc3RvbEZhY3RvcnkgfSBmcm9tIFwiLi9QaXN0b2xcIjtcclxuaW1wb3J0IHsgUm9ja2V0R3VuRmFjdG9yeSB9IGZyb20gXCIuL1JvY2tldEd1blwiO1xyXG5pbXBvcnQgeyBTY2VuZSB9IGZyb20gXCIuL1NjZW5lXCI7XHJcblxyXG5pbnRlcmZhY2UgSVBhcmFtcyB7XHJcbiAgICBtYW5kYWxvcmlhbjogUGhhc2VyLkdhbWVPYmplY3RzLkNvbnRhaW5lcjsgXHJcbiAgICB3ZWFwb25zOiBNYW5kYWxvcmlhbldlYXBvbnM7XHJcbiAgICBrZXlib2FyZDogUGhhc2VyLklucHV0LktleWJvYXJkLktleWJvYXJkUGx1Z2luO1xyXG4gICAgbW91c2U6IFBoYXNlci5JbnB1dC5Qb2ludGVyO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgTWFuZGFsb3JpYW4ge1xyXG4gICAgbWFuZGFsb3JpYW46IFBoYXNlci5HYW1lT2JqZWN0cy5Db250YWluZXI7XHJcbiAgICB3ZWFwb25zOiBNYW5kYWxvcmlhbldlYXBvbnM7XHJcbiAgICBtb3VzZTogUGhhc2VyLklucHV0LlBvaW50ZXI7XHJcblxyXG4gICAgdXA6IFBoYXNlci5JbnB1dC5LZXlib2FyZC5LZXlbXTtcclxuICAgIGxlZnQ6IFBoYXNlci5JbnB1dC5LZXlib2FyZC5LZXlbXTtcclxuICAgIGJvdHRvbTogUGhhc2VyLklucHV0LktleWJvYXJkLktleVtdO1xyXG4gICAgcmlnaHQ6IFBoYXNlci5JbnB1dC5LZXlib2FyZC5LZXlbXTtcclxuXHJcbiAgICBzcGVlZCA9IFBoYXNlci5NYXRoLkdldFNwZWVkKDEwMCwgMSk7XHJcblxyXG4gICAgY29uc3RydWN0b3Ioe21hbmRhbG9yaWFuLCB3ZWFwb25zLCBrZXlib2FyZCwgbW91c2V9OiBJUGFyYW1zKSB7XHJcbiAgICAgICAgdGhpcy5tYW5kYWxvcmlhbiA9IG1hbmRhbG9yaWFuO1xyXG4gICAgICAgIHRoaXMud2VhcG9ucyA9IHdlYXBvbnM7XHJcbiAgICAgICAgdGhpcy5tb3VzZSA9IG1vdXNlO1xyXG5cclxuICAgICAgICB0aGlzLnVwID0gW2tleWJvYXJkLmFkZEtleSgndXAnKSwga2V5Ym9hcmQuYWRkS2V5KCdFJyldO1xyXG4gICAgICAgIHRoaXMubGVmdCA9IFtrZXlib2FyZC5hZGRLZXkoJ2xlZnQnKSwga2V5Ym9hcmQuYWRkS2V5KCdTJyldO1xyXG4gICAgICAgIHRoaXMuYm90dG9tID0gW2tleWJvYXJkLmFkZEtleSgnZG93bicpLCBrZXlib2FyZC5hZGRLZXkoJ0QnKV07XHJcbiAgICAgICAgdGhpcy5yaWdodCA9IFtrZXlib2FyZC5hZGRLZXkoJ3JpZ2h0JyksIGtleWJvYXJkLmFkZEtleSgnRicpXTtcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGUodGltZTogbnVtYmVyLCBkZWx0YTogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy53ZWFwb25zLnVwZGF0ZSh0aW1lLCBkZWx0YSk7XHJcblxyXG4gICAgICAgIHRoaXMubWFuZGFsb3JpYW4ueCArPSBkZWx0YSAqIHRoaXMuc3BlZWQgKiAoTnVtYmVyKHRoaXMucmlnaHQuc29tZSh4ID0+IHguaXNEb3duKSkgLSBOdW1iZXIodGhpcy5sZWZ0LnNvbWUoeCA9PiB4LmlzRG93bikpKTtcclxuICAgICAgICB0aGlzLm1hbmRhbG9yaWFuLnkgKz0gZGVsdGEgKiB0aGlzLnNwZWVkICogKE51bWJlcih0aGlzLmJvdHRvbS5zb21lKHggPT4geC5pc0Rvd24pKSAtIE51bWJlcih0aGlzLnVwLnNvbWUoeCA9PiB4LmlzRG93bikpKTtcclxuXHJcbiAgICAgICAgdGhpcy5tYW5kYWxvcmlhbi5zZXRSb3RhdGlvbihQaGFzZXIuTWF0aC5BbmdsZS5CZXR3ZWVuKHRoaXMubW91c2UueCwgdGhpcy5tb3VzZS55LCB0aGlzLm1hbmRhbG9yaWFuLngsIHRoaXMubWFuZGFsb3JpYW4ueSkgLSBNYXRoLlBJIC8gMik7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBNYW5kYWxvcmlhbkZhY3Rvcnkge1xyXG4gICAgc3RhdGljIHJlYWRvbmx5IG1hbmRhbG9yaWFuU3ByaXRlID0gJ21hbmRhbG9yaWFuU3ByaXRlJ1xyXG5cclxuICAgIHN0YXRpYyBsb2FkKHNjZW5lOiBTY2VuZSkge1xyXG4gICAgICAgIFBpc3RvbEZhY3RvcnkubG9hZChzY2VuZSk7XHJcbiAgICAgICAgUm9ja2V0R3VuRmFjdG9yeS5sb2FkKHNjZW5lKTtcclxuICAgICAgICBzY2VuZS5sb2FkLmltYWdlKE1hbmRhbG9yaWFuRmFjdG9yeS5tYW5kYWxvcmlhblNwcml0ZSwgJ2Fzc2V0cy9tYW5kYWxvcmlhbi5wbmcnKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgY3JlYXRlKHNjZW5lOiBTY2VuZSkge1xyXG4gICAgICAgIGNvbnN0IGtleWJvYXJkID0gc2NlbmUuaW5wdXQua2V5Ym9hcmQ7XHJcbiAgICAgICAgY29uc3QgbW91c2UgPSBzY2VuZS5pbnB1dC5tb3VzZVBvaW50ZXI7XHJcbiAgICAgICAgY29uc3QgbWFuZGFsb3JpYW5TcHJpdGUgPSBzY2VuZS5hZGQuc3ByaXRlKDAsIDAsIE1hbmRhbG9yaWFuRmFjdG9yeS5tYW5kYWxvcmlhblNwcml0ZSk7XHJcbiAgICAgICAgY29uc3QgbWFuZGFsb3JpYW4gPSBzY2VuZS5hZGQuY29udGFpbmVyKDQwMCwgNDAwLCBbbWFuZGFsb3JpYW5TcHJpdGVdKS5zZXREZXB0aCgxKTsgICAgICAgIFxyXG4gICAgICAgIGNvbnN0IHdlYXBvbnMgPSBNYW5kYWxvcmlhbldlYXBvbkZhY3RvcnkuY3JlYXRlKHNjZW5lLCBtYW5kYWxvcmlhbik7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBNYW5kYWxvcmlhbih7bWFuZGFsb3JpYW4sIHdlYXBvbnMsIGtleWJvYXJkLCBtb3VzZX0pO1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IHsgUGlzdG9sLCBQaXN0b2xGYWN0b3J5IH0gZnJvbSBcIi4vUGlzdG9sXCI7XHJcbmltcG9ydCB7IFJvY2tldEd1biwgUm9ja2V0R3VuRmFjdG9yeSB9IGZyb20gXCIuL1JvY2tldEd1blwiO1xyXG5pbXBvcnQgeyBTY2VuZSB9IGZyb20gXCIuL1NjZW5lXCI7XHJcblxyXG5pbnRlcmZhY2UgSVBhcmFtcyB7XHJcbiAgICBwaXN0b2w6IFBpc3RvbDtcclxuICAgIHJvY2tldEd1bjogUm9ja2V0R3VuO1xyXG4gICAgaW5wdXQ6IFBoYXNlci5JbnB1dC5JbnB1dFBsdWdpbjsgICAgXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBNYW5kYWxvcmlhbldlYXBvbnMge1xyXG4gICAgd2VhcG9uczogSU1hbmRhbG9yaWFuV2VhcG9uW107XHJcbiAgICBhY3RpdmVJbmRleCA9IDA7XHJcbiAgICBpc0F0dGFjazogYm9vbGVhbjtcclxuICAgIG1vdXNlOiBQaGFzZXIuSW5wdXQuUG9pbnRlcjtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcih7cGlzdG9sLCByb2NrZXRHdW4sIGlucHV0fSA6IElQYXJhbXMpIHtcclxuICAgICAgICB0aGlzLndlYXBvbnMgPSBbcGlzdG9sLCByb2NrZXRHdW5dOyAgICBcclxuXHJcbiAgICAgICAgaW5wdXQua2V5Ym9hcmQuYWRkS2V5KCdXJykub24oUGhhc2VyLklucHV0LktleWJvYXJkLkV2ZW50cy5ET1dOLCB0aGlzLnN3aXRjaFdlYXBvbnMpO1xyXG4gICAgICAgIGlucHV0LmtleWJvYXJkLmFkZEtleSgnQ1RSTCcpLm9uKFBoYXNlci5JbnB1dC5LZXlib2FyZC5FdmVudHMuRE9XTiwgdGhpcy5zd2l0Y2hXZWFwb25zKTtcclxuICAgICAgICBpbnB1dC5vbihQaGFzZXIuSW5wdXQuRXZlbnRzLlBPSU5URVJfRE9XTiwgKCkgPT4gdGhpcy5maXJlKHRydWUpKTtcclxuICAgICAgICBpbnB1dC5vbihQaGFzZXIuSW5wdXQuRXZlbnRzLlBPSU5URVJfVVAsICgpID0+IHRoaXMuZmlyZShmYWxzZSkpO1xyXG5cclxuICAgICAgICB0aGlzLmdldFdlYXBvbigpLmFjdGl2YXRlKHRydWUpO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZSh0aW1lOiBudW1iZXIsIGRlbHRhOiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLndlYXBvbnMuZm9yRWFjaCh3ID0+IHcudXBkYXRlKHRpbWUsIGRlbHRhKSk7XHJcbiAgICB9XHJcblxyXG4gICAgZmlyZShpc0ZpcmUpIHtcclxuICAgICAgICB0aGlzLmdldFdlYXBvbigpLmZpcmUoaXNGaXJlKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRXZWFwb24gPSAoKSA9PiB0aGlzLndlYXBvbnNbdGhpcy5hY3RpdmVJbmRleF07XHJcblxyXG4gICAgc3dpdGNoV2VhcG9ucyA9ICgpID0+IHtcclxuICAgICAgICB0aGlzLmdldFdlYXBvbigpLmFjdGl2YXRlKGZhbHNlKTtcclxuICAgICAgICB0aGlzLnN3aXRjaEluZGV4KCk7XHJcbiAgICAgICAgdGhpcy5nZXRXZWFwb24oKS5hY3RpdmF0ZSh0cnVlKTtcclxuICAgIH1cclxuXHJcbiAgICBzd2l0Y2hJbmRleCgpIHtcclxuICAgICAgICBpZiAoKyt0aGlzLmFjdGl2ZUluZGV4ID49IHRoaXMud2VhcG9ucy5sZW5ndGgpIFxyXG4gICAgICAgICAgICB0aGlzLmFjdGl2ZUluZGV4ID0gMDtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIE1hbmRhbG9yaWFuV2VhcG9uRmFjdG9yeSB7XHJcbiAgICBzdGF0aWMgY3JlYXRlKHNjZW5lOiBTY2VuZSwgY29udGFpbmVyOiBQaGFzZXIuR2FtZU9iamVjdHMuQ29udGFpbmVyKSB7XHJcbiAgICAgICAgY29uc3QgaW5wdXQgPSBzY2VuZS5pbnB1dDtcclxuICAgICAgICBcclxuICAgICAgICBjb25zdCBwaXN0b2wgPSBQaXN0b2xGYWN0b3J5LmNyZWF0ZShzY2VuZSwgY29udGFpbmVyKTtcclxuICAgICAgICBjb25zdCByb2NrZXRHdW4gPSBSb2NrZXRHdW5GYWN0b3J5LmNyZWF0ZShzY2VuZSwgY29udGFpbmVyKTsgICAgICAgIFxyXG4gICAgICAgIHJldHVybiBuZXcgTWFuZGFsb3JpYW5XZWFwb25zKHtwaXN0b2wsIHJvY2tldEd1biwgaW5wdXR9KTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBJTWFuZGFsb3JpYW5XZWFwb24ge1xyXG4gICAgYWN0aXZhdGUoaXNBY3RpdmF0ZTogYm9vbGVhbik6IHZvaWQ7XHJcbiAgICBmaXJlKGlzRmlyZSk6IHZvaWQ7XHJcbiAgICB1cGRhdGUodGltZTogbnVtYmVyLCBkZWx0YTogbnVtYmVyKTogdm9pZDtcclxufSJdLCJzb3VyY2VSb290IjoiIn0=